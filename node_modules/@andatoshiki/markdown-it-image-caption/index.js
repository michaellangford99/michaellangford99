'use strict'

module.exports = function cap_plugin(md) {
  // console.log(md.renderer.rules);
  var old = md.renderer.rules.image

  md.renderer.rules.image = function (tokens, idx, options, env, self) {
    if (tokens[idx].attrs[2]) {
      let attrs = tokens[idx].attrs
      let title = attrs[2][1]
      let src = attrs[0][1]
      let alt = tokens[idx].content
      return `<figure class="figure"><img src="${src}" class="figure-img img-fluid rounded" alt="${alt}" title="${title}"><figcaption class="figure-caption text-center" align="center">${title}</figcaption></figure>`
    }
    return old(tokens, idx, options, env, self)
  }
}