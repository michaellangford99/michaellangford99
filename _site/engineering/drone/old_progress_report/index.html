
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
   <title>ECE477 Drone</title> 
   
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <!---<link rel="stylesheet" href="/assets/css/prism-vsc-dark-plus.css"/>  -->
    <!---<link href="https://unpkg.com/prismjs@1.20.0/themes/prism.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="/assets/css/prism-vs.css">
    <link rel="stylesheet" href="/assets/css/clean-blog.css">
    
  </head>
  <body>


<nav class="navbar navbar-expand-lg bg-body-tertiary bg-dark border-bottom border-bottom-dark" data-bs-theme="dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Michaelangelo</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">

    
    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
      <li class="nav-item">
        <a class="nav-link" href="/hiking/">Hiking &amp; Photography</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/engineering/">Engineering</a>
      </li>
    </ul>

<!--
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#">Home</a>
        </li>

        <li class="nav-item"><a class="nav-link" href="#">Hiking & Photograpy</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Engineering</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Computer Graphics</a></li>       
        <li class="nav-item"><a class="nav-link" href="#">Thoughts</a></li>
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Dropdown
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Action</a></li>
            <li><a class="dropdown-item" href="#">Another action</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Something else here</a></li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled">Disabled</a>
        </li>


      </ul>
-->

      <!--<form class="d-flex" role="search">
        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Search</button>
      </form>-->
    </div>
  </div>
</nav>
    
<div class="bg-image p-5 text-center shadow-1-strong mb-2 text-white" style="background-image: url('/assets/images/crestone.jpg'); background-position: center; background-size:cover;">
<div style="padding: 100px 0 130px ">
  <h1 class="mb-2 h1">ECE477 Drone</h1>
  <p>
    
  </p>
</div>
</div>

<!--<div class="container-md">
  <div class="alert alert-primary" role="alert">
    This was going to be the nav bar but now I might get rid of this lol.
  </div>
</div>-->

     <div class="container-md">
        <div class="row justify-content-center">
            <div class="col-2 ">
              
            </div>
            <div class="col-md-8 ">
                 <h1>8/10/2023</h1>
<p><strong>Date:</strong> 12/2/2022</p>
<p><strong>Total hours:</strong> 25+</p>
<p><strong>Description of design efforts:</strong></p>
<p><strong>IMU</strong></p>
<p>This was mostly last week, but I created an algorithm to modify in real time the parameter controlling the relative trust the complementary filter has in the gyro vs. the accelerometer. It works by sensing when the length of the vector comprising the total acceleration felt by the accelerometer is greater in magnitude than 1G, indicating that noise or movement is taking place. The differential is the used to generate a correction factor to apply to the parameter ‘Alpha’ which estimates which measurement is more accurate.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 1. Source code of filter correction algorithm"><figcaption class="figure-caption text-center" align="center">Fig. 15- 1. Source code of filter correction algorithm</figcaption></figure></div></p>
<p>In addition to the LSM6DSO, there is also an MPU6500 on the PCB, which has not as yet been used. I also wrote driver code for that this week, which wasn’t hard seeing as I already had code for it from an old project. This meant the bulk of the effort was just switching from the previous project’s SPI implementation to the current one. I then cloned the LSM6DSO driver’s calibration and sensor fusion code, and got things nearly working, and then 4</p>
<p>Due to my original code structure, there was no way to change or specify the CS pin, meaning that the SPI bus would blindly use the CS pin it chose on startup, rather than using different ones per device. So I created a structure that holds the IMU data that can be accessed by any other C file, as well as adding functionality and pin setup code to select which CS pin is active at that point in time, and the SPI driver will switch to using that one.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-1.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 2. SPI bus selection"><figcaption class="figure-caption text-center" align="center">Fig. 15- 2. SPI bus selection</figcaption></figure></div></p>
<p>With this new structure working, I tried running the full PID loop + motor + radio code to test the response of the drone. Unfortunately, I noticed immediately that there was a huge issue with the noise induced in the data by the vibration from the motors running.
I found an application that can perform a real time FFT on incoming serial data, to take a look at the noise spectrum while the motors are running. I was hoping all the noise was high frequency and could be filtered, however it was broadband, and the gyro was hitting it’s max dynamic range as well.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-2.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 3. Serial Spectrogram"><figcaption class="figure-caption text-center" align="center">Fig. 15- 3. Serial Spectrogram</figcaption></figure></div></p>
<p>With the motors running and the drone still, the pitch and roll quickly diverged from an accurate measurement of the heading.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-3.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 4. Very messed up gyro readings"><figcaption class="figure-caption text-center" align="center">Fig. 15- 4. Very messed up gyro readings</figcaption></figure></div></p>
<p><strong>Mechanical</strong></p>
<p>In order to fix the vibration issues, I had to use an alternate mount to the original rigid mounting setup. I found a piece of soft anti-static foam, and glued the 3D printed mount onto the foam, and then onto the motor controller.</p>
<p>I initially just tried using O-rings at the mount points, however this wasn’t sufficient.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-4.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 5. Trying to use O-rings to damped vibration"><figcaption class="figure-caption text-center" align="center">Fig. 15- 5. Trying to use O-rings to damped vibration</figcaption></figure></div></p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-5.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 6. Trying out foam"><figcaption class="figure-caption text-center" align="center">Fig. 15- 6. Trying out foam</figcaption></figure></div></p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-6.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 7. Foam sized properly"><figcaption class="figure-caption text-center" align="center">Fig. 15- 7. Foam sized properly</figcaption></figure></div></p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-7.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 8. Trying foam and rubber mounts"><figcaption class="figure-caption text-center" align="center">Fig. 15- 8. Trying foam and rubber mounts</figcaption></figure></div></p>
<p>I also mounted the battery to the bottom of the drone using some very strong Velcro-ish stuff.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-8.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 9. Battery mounted"><figcaption class="figure-caption text-center" align="center">Fig. 15- 9. Battery mounted</figcaption></figure></div></p>
<p><strong>Electrical</strong></p>
<p>Usage of the batteries finally necessitated charging, so we used a typical multi-cell LiPo charger to charge them.</p>
<p>The radio also had to be permanently mounted, as it had been connected with a temporary connector initially.</p>
<p>To be described later:
Radio mounting</p>
<ul>
<li>
<p>PI UART</p>
<ul>
<li>Frame setup</li>
</ul>
</li>
<li>
<p>Wiring</p>
<ul>
<li>Testing</li>
</ul>
</li>
<li>
<p>Motor configuration</p>
<ul>
<li>Flashing Nano</li>
<li>Trying other stuff</li>
<li>Wiring it up</li>
<li>Usage of app</li>
<li>Configuration and motor spin direction</li>
</ul>
</li>
<li>
<p>Safety and arming code</p>
</li>
<li>
<p>Startup message</p>
</li>
<li>
<p>PID loop improvements</p>
</li>
<li>
<p>Motor LPF with hanning window</p>
</li>
<li>
<p>Show MATLAB</p>
</li>
</ul>

            </div>
            <div class="col-2 ">
              
            </div>
        </div>
    </div>

<!--<div class="b-example-divider"></div>-->

<div class="container">
  <footer class="flex-wrap border-top">
      <p class="text-center text-muted">© 2023 Michael Langford. Built with 11ty.</p>
  </footer>
</div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
  <script src="/assets/js/index.js"></script>
  <script data-goatcounter="https://michaellangford99.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>
  </body>
</html>
