
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="google-site-verification" content="jWYz4n1G8T7OHT4uWrEfZc6Qx-KFsPUYCC6oLXvfJHs">

    <!-- Bootstrap CSS -->
   <title>ECE477 Drone</title> 
   
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <!---<link rel="stylesheet" href="/assets/css/prism-vsc-dark-plus.css"/>  -->
    <!---<link href="https://unpkg.com/prismjs@1.20.0/themes/prism.css" rel="stylesheet"> -->
   <!--- <link rel="stylesheet" href="/assets/css/prism-vs.css"/>    -->
   <link rel="stylesheet" href="/assets/css/prism-vsc-dark-plus.css">
    <link rel="stylesheet" href="/assets/css/clean-blog.css">
    <link rel="stylesheet" href="/assets/css/vertical_carousel.css">
    
  <style id="MJX-SVG-styles">
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}
</style></head>
  <body>
    <div id="carouselExampleControls" class="vertical carousel carousel-dark slide vertical" data-bs-interval="false">
      <div class="align-content-center" style="height:100%">
        <div class="carousel-inner" data-bs-interval="false">

<div class="carousel-item active">

<h1 class="text-center">ECE477 Drone</h1>
<h2 class="text-center">Michael Langford</h2>

</div>

<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Drone Overview</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg align-content-center">
<p><strong>Project Overview:</strong></p>
<ul>
<li>Designed, built, and flew custom drone</li>
<li>Completely custom flight controller hardware and software</li>
<li>Required mechanical, hardware, software, and algorithm/signal processing skills to succesfully complete the project</li>
</ul>
<p><strong>Objectives:</strong></p>
<ul>
<li>Custom flight controller to maintain flight, responsible for stabilization and altitude hold</li>
<li>Pi zero to act as guidance and navigation computer, responsible for camera and LiDAR based obstacle avoidance and heading commands</li>
</ul>
<p><strong>Results:</strong></p>
<ul>
<li>Succesfull flight controller design, stable and controlable flight with altitude hold</li>
<li>Work remains for implementation of navigation capability, but effective system integration of the two modules</li>
</ul>
</div>
<div class="col-lg align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="IMG_6637.jpg" class="figure-img img-fluid rounded" alt="alt text" title="Flight test!"><figcaption class="figure-caption text-center" align="center">Flight test!</figcaption></figure></div></p>
</div>
</div>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_drone_overview/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Initial part selection</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg align-content-center">
<p><strong>Parts selection &amp; Weight / Current / Thrust calculations</strong></p>
<p>In order to determine the proper parts to order for the drone itself, i.e. the frame, motors, battery, propellers, and motors controller, I had to do extensive research.</p>
<p>This week I worked on, and have nearly completed, determining the correct parts. I started with the physical frame, choosing the size that would allow the electronics necessary for completing the project.</p>
<p>This necessitated a 5” size drone frame (5” propellers).</p>
<p>Next, I created a complex spreadsheet to calculate the necessary battery capacity for a minimum flight time, given inputs concerning the motor thrust, current, and drone parts’ weights.</p>
<p>The spreadsheet first calculates the total weight of the drone, taking into account each part. Prospective parts can be entered so as to see if, for example, a motor controller provides enough current but is too heavy.</p>
<p>With the full weight calculated, the thrust is the next necessary calculation. Using propeller-motor pair data available online for ubiquitous motor-propeller combinations, along with seller data, the current at 75% throttle and the thrust at that throttle could be entered.</p>
<p>From the thrust-current measurement, a crude linearization gives the amps of current per gram of thrust - amps per unit thrust</p>
<p><mjx-container class="MathJax" jax="SVG" display="true" style="position: relative;"><svg style="vertical-align: -2.172ex;" xmlns="http://www.w3.org/2000/svg" width="34.148ex" height="5.475ex" role="img" focusable="false" viewBox="0 -1460 15093.6 2420" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><defs><path id="MJX-1-TEX-S3-5B" d="M247 -949V1450H516V1388H309V-887H516V-949H247Z"></path><path id="MJX-1-TEX-I-1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path id="MJX-1-TEX-I-1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path><path id="MJX-1-TEX-S3-5D" d="M11 1388V1450H280V-949H11V-887H218V1388H11Z"></path><path id="MJX-1-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-1-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path id="MJX-1-TEX-I-1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-I-1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path id="MJX-1-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-1-TEX-N-40" d="M56 347Q56 429 86 498T164 612T270 680T386 705Q522 705 622 603T722 349Q722 126 608 126Q541 126 513 176Q512 177 512 179T510 182L509 183Q508 183 503 177T487 163T464 146T429 132T385 126Q311 126 251 186T190 347Q190 448 251 508T385 568Q426 568 460 548T509 511T531 479H555Q580 479 582 478Q586 477 587 468Q588 454 588 338V260Q588 200 593 182T619 163Q641 163 655 178T674 223T680 273T682 325V330Q682 426 647 500Q611 569 544 618T388 668Q271 668 184 577T96 347Q96 216 180 121T396 26Q421 26 446 28T493 34T535 43T573 52T605 63T629 72T647 80T657 84H716Q722 78 722 74Q722 65 675 45T547 7T392 -11Q255 -11 156 90T56 347ZM274 347Q274 266 308 214T390 162Q420 162 449 182T498 235L504 245V449L498 459Q453 532 387 532Q347 532 311 483T274 347Z"></path><path id="MJX-1-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path id="MJX-1-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-1-TEX-I-1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path><path id="MJX-1-TEX-I-210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path id="MJX-1-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-1-TEX-I-1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path><path id="MJX-1-TEX-N-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path id="MJX-1-TEX-N-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path><path id="MJX-1-TEX-I-1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo" transform="translate(0 -0.5)"><use data-c="5B" xlink:href="#MJX-1-TEX-S3-5B"></use></g><g data-mml-node="mfrac" transform="translate(528,0)"><g data-mml-node="mi" transform="translate(220,676)"><use data-c="1D434" xlink:href="#MJX-1-TEX-I-1D434"></use></g><g data-mml-node="mi" transform="translate(356.5,-686)"><use data-c="1D454" xlink:href="#MJX-1-TEX-I-1D454"></use></g><rect width="950" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(1718,0) translate(0 -0.5)"><use data-c="5D" xlink:href="#MJX-1-TEX-S3-5D"></use></g></g><g data-mml-node="mo" transform="translate(2523.8,0)"><use data-c="3D" xlink:href="#MJX-1-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(3579.6,0)"><g data-mml-node="mrow" transform="translate(220,710)"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-1-TEX-I-1D450"></use></g><g data-mml-node="mi" transform="translate(433,0)"><use data-c="1D462" xlink:href="#MJX-1-TEX-I-1D462"></use></g><g data-mml-node="mi" transform="translate(1005,0)"><use data-c="1D45F" xlink:href="#MJX-1-TEX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(1456,0)"><use data-c="1D45F" xlink:href="#MJX-1-TEX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(1907,0)"><use data-c="1D452" xlink:href="#MJX-1-TEX-I-1D452"></use></g><g data-mml-node="mi" transform="translate(2373,0)"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mi" transform="translate(2973,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(3334,0)"><g data-mml-node="mo"><use data-c="40" xlink:href="#MJX-1-TEX-N-40"></use></g></g><g data-mml-node="mn" transform="translate(4112,0)"><use data-c="37" xlink:href="#MJX-1-TEX-N-37"></use><use data-c="35" xlink:href="#MJX-1-TEX-N-35" transform="translate(500,0)"></use></g><g data-mml-node="mi" transform="translate(5112,0)"><use data-c="1D45D" xlink:href="#MJX-1-TEX-I-1D45D"></use></g><g data-mml-node="mi" transform="translate(5615,0)"><use data-c="1D450" xlink:href="#MJX-1-TEX-I-1D450"></use></g><g data-mml-node="mi" transform="translate(6048,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(6409,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(6770,0)"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g><g data-mml-node="mi" transform="translate(7346,0)"><use data-c="1D45F" xlink:href="#MJX-1-TEX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(7797,0)"><use data-c="1D45C" xlink:href="#MJX-1-TEX-I-1D45C"></use></g><g data-mml-node="mi" transform="translate(8282,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(8643,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(9004,0)"><use data-c="1D459" xlink:href="#MJX-1-TEX-I-1D459"></use></g><g data-mml-node="mi" transform="translate(9302,0)"><use data-c="1D452" xlink:href="#MJX-1-TEX-I-1D452"></use></g><g data-mml-node="mo" transform="translate(9768,0)"><use data-c="5B" xlink:href="#MJX-1-TEX-N-5B"></use></g><g data-mml-node="mi" transform="translate(10046,0)"><use data-c="1D434" xlink:href="#MJX-1-TEX-I-1D434"></use></g><g data-mml-node="mo" transform="translate(10796,0)"><use data-c="5D" xlink:href="#MJX-1-TEX-N-5D"></use></g></g><g data-mml-node="mrow" transform="translate(628.5,-710)"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(361,0)"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g><g data-mml-node="mi" transform="translate(937,0)"><use data-c="1D45F" xlink:href="#MJX-1-TEX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(1388,0)"><use data-c="1D462" xlink:href="#MJX-1-TEX-I-1D462"></use></g><g data-mml-node="mi" transform="translate(1960,0)"><use data-c="1D460" xlink:href="#MJX-1-TEX-I-1D460"></use></g><g data-mml-node="mi" transform="translate(2429,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2790,0)"><g data-mml-node="mo"><use data-c="40" xlink:href="#MJX-1-TEX-N-40"></use></g></g><g data-mml-node="mn" transform="translate(3568,0)"><use data-c="37" xlink:href="#MJX-1-TEX-N-37"></use><use data-c="35" xlink:href="#MJX-1-TEX-N-35" transform="translate(500,0)"></use></g><g data-mml-node="mi" transform="translate(4568,0)"><use data-c="1D45D" xlink:href="#MJX-1-TEX-I-1D45D"></use></g><g data-mml-node="mi" transform="translate(5071,0)"><use data-c="1D450" xlink:href="#MJX-1-TEX-I-1D450"></use></g><g data-mml-node="mi" transform="translate(5504,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(5865,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(6226,0)"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g><g data-mml-node="mi" transform="translate(6802,0)"><use data-c="1D45F" xlink:href="#MJX-1-TEX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(7253,0)"><use data-c="1D45C" xlink:href="#MJX-1-TEX-I-1D45C"></use></g><g data-mml-node="mi" transform="translate(7738,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(8099,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(8460,0)"><use data-c="1D459" xlink:href="#MJX-1-TEX-I-1D459"></use></g><g data-mml-node="mi" transform="translate(8758,0)"><use data-c="1D452" xlink:href="#MJX-1-TEX-I-1D452"></use></g><g data-mml-node="mo" transform="translate(9224,0)"><use data-c="5B" xlink:href="#MJX-1-TEX-N-5B"></use></g><g data-mml-node="mi" transform="translate(9502,0)"><use data-c="1D454" xlink:href="#MJX-1-TEX-I-1D454"></use></g><g data-mml-node="mo" transform="translate(9979,0)"><use data-c="5D" xlink:href="#MJX-1-TEX-N-5D"></use></g></g><rect width="11274" height="60" x="120" y="220"></rect></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mfrac><mi>A</mi><mi>g</mi></mfrac><mo data-mjx-texclass="CLOSE">]</mo></mrow><mo>=</mo><mfrac><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mrow data-mjx-texclass="ORD"><mo>@</mo></mrow><mn>75</mn><mi>p</mi><mi>c</mi><mi>t</mi><mi>t</mi><mi>h</mi><mi>r</mi><mi>o</mi><mi>t</mi><mi>t</mi><mi>l</mi><mi>e</mi><mo stretchy="false">[</mo><mi>A</mi><mo stretchy="false">]</mo></mrow><mrow><mi>t</mi><mi>h</mi><mi>r</mi><mi>u</mi><mi>s</mi><mi>t</mi><mrow data-mjx-texclass="ORD"><mo>@</mo></mrow><mn>75</mn><mi>p</mi><mi>c</mi><mi>t</mi><mi>t</mi><mi>h</mi><mi>r</mi><mi>o</mi><mi>t</mi><mi>t</mi><mi>l</mi><mi>e</mi><mo stretchy="false">[</mo><mi>g</mi><mo stretchy="false">]</mo></mrow></mfrac></math></mjx-assistive-mml></mjx-container>.</p>
</div>
<div class="col-lg align-content-center">
<div class="d-flex justify-content-center">
<table>
<thead>
<tr>
<th>Minimum Flight Time</th>
<th>120</th>
<th>seconds</th>
</tr>
</thead>
<tbody>
<tr>
<td>frame weight</td>
<td>100</td>
<td>grams</td>
</tr>
<tr>
<td>motor weight</td>
<td>126.4</td>
<td>grams</td>
</tr>
<tr>
<td>propellers</td>
<td>4</td>
<td>grams</td>
</tr>
<tr>
<td>4in1 ESC weight</td>
<td>21</td>
<td>grams</td>
</tr>
<tr>
<td>radio reciever</td>
<td>2</td>
<td>grams</td>
</tr>
<tr>
<td>single-board computer</td>
<td>10</td>
<td>grams</td>
</tr>
<tr>
<td>flight controller</td>
<td>20</td>
<td></td>
</tr>
<tr>
<td>camera</td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>Typical 4S 1200mAh battery</td>
<td>100</td>
<td>grams</td>
</tr>
<tr>
<td>additional wiring</td>
<td>20</td>
<td>grams</td>
</tr>
<tr>
<td>total weight</td>
<td>407.4</td>
<td>grams</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>thrust from chosen 2306 brushless</td>
<td>1526</td>
<td>grams</td>
</tr>
<tr>
<td>amps at above thrust</td>
<td>51.3</td>
<td>A</td>
</tr>
<tr>
<td>amp/g thrust</td>
<td>0.0336173</td>
<td>A/grams</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>total thrust necessary</td>
<td>1222.2</td>
<td>grams (3x drone weight)</td>
</tr>
<tr>
<td>thrust per motor</td>
<td>305.55</td>
<td>grams</td>
</tr>
<tr>
<td>current at given thrust</td>
<td>3.423922018</td>
<td>A</td>
</tr>
<tr>
<td>processor and nav current</td>
<td>3</td>
<td>A</td>
</tr>
<tr>
<td>total current</td>
<td>16.69568807</td>
<td>(4x motor current, +FC current)</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>hours of flight time</td>
<td>0.033333333</td>
<td>h</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>mAh necessary</td>
<td>556.5229358</td>
<td>mAh</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_part_selection_0/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Initial part selection</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg align-content-center">
<p>To create this sheet required significant research into individual parts, and which motors would work well with which propellers, and what frame size could accommodate what motor controller, and if the motor controller had enough current to be able to properly power the motors.</p>
<p>This resulted in the preliminary selection of the following parts:</p>
<div class="d-flex justify-content-center">
<table>
<thead>
<tr>
<th>Part</th>
<th>Selection</th>
</tr>
</thead>
<tbody>
<tr>
<td>Motor controller / ESC</td>
<td><a href="https://www.racedayquads.com/products/t-motor-velox-45a-32bit-3-6s-30x30-4in1-esc-1?variant=32293091115121">T-Motor Velox 45A 30x30mm 4in1 ESC</a></td>
</tr>
<tr>
<td>Motors</td>
<td><a href="https://www.racedayquads.com/products/iflight-xing2-2306-2555kv-motor?variant=32320681279601">iFlight Xing2 2305 2555Kv Motor</a></td>
</tr>
<tr>
<td>Frame</td>
<td><a href="https://www.racedayquads.com/products/rdq-source-one-v3-5-freestyle-frame?variant=29592522293361">RDQ Source One 5” Freestyle Frame</a></td>
</tr>
<tr>
<td>Propellers</td>
<td><a href="https://www.racedayquads.com/products/t-motor-t5147-popo-compatible-tri-blade-5-prop-4-pack-choose-your-color?variant=31263896502385">T-Motor T5147 Tri-blade 5”, 4-pack</a></td>
</tr>
<tr>
<td>Battery</td>
<td><a href="https://www.racedayquads.com/products/rdq-series-15-2v-4s-550mah-100c-lihv-battery-xt30">4S 100C 550mAh LiPo</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="col-lg align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="IMG_20220916_133510641_HDR.jpg" class="figure-img img-fluid rounded" alt="alt text" title="Purchased frame parts and motors"><figcaption class="figure-caption text-center" align="center">Purchased frame parts and motors</figcaption></figure></div></p>
</div>
</div>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_part_selection_1/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">System Overview</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-6.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 4.7a. System Block Diagram"><figcaption class="figure-caption text-center" align="center">Fig. 4.7a. System Block Diagram</figcaption></figure></div></p>
</div>
<div class="col-lg align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-7.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 4.7b. Flight Controller Block Diagram"><figcaption class="figure-caption text-center" align="center">Fig. 4.7b. Flight Controller Block Diagram</figcaption></figure></div></p>
</div>
</div>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_block_diagrams/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Scheduling</h1>
<div class="container align-content-center" style="height: 100%">
<p>Schedule creation was critical; together with the team I developed a Gantt style chart to show dependency and project trajectory for various subtasks and how they integrate into the project as a whole.</p>
<style type="text/css">
#schedule table tr td {
   padding: 0 10px 0 10px;
   margin: 0;
}
</style>
<div id="schedule" class="d-flex justify-content-center p-0 m-0">
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th>Week 4</th>
<th>Week 5</th>
<th>Week 6</th>
<th>Week 7</th>
<th>Week 8</th>
<th>Week 9</th>
<th>Week 10</th>
<th>Week 11</th>
<th>Week 12</th>
<th>Week 13</th>
<th>Week 14</th>
<th>Week 15</th>
<th>Week 16</th>
</tr>
</thead>
<tbody>
<tr>
<td>Interfacing</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Protocols</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>SPI</td>
<td><div class="p-2 mb-0 bg-secondary text-white"></div></td>
<td><div class="p-2 mb-0 bg-secondary text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>I2C</td>
<td><div class="p-2 mb-0 bg-secondary text-white"></div></td>
<td><div class="p-2 mb-0 bg-secondary text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>UART</td>
<td><div class="p-2 mb-0 bg-secondary text-white"></div></td>
<td><div class="p-2 mb-0 bg-secondary text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>PWM</td>
<td><div class="p-2 mb-0 bg-secondary text-white"></div></td>
<td><div class="p-2 mb-0 bg-secondary text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Analog Read</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Drivers</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Motor PWM</td>
<td></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Radio</td>
<td></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>MPU9250</td>
<td></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>LSM6DSOWTR</td>
<td></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>ICM20948</td>
<td></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>VL53L1X</td>
<td></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Pi communication</td>
<td></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Battery monitor</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Driver integration</td>
<td></td>
<td></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td><div class="p-2 mb-0 bg-primary text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Algorithms</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Sensor Fusion</td>
<td></td>
<td></td>
<td></td>
<td><div class="p-2 mb-0 bg-danger text-white"></div></td>
<td><div class="p-2 mb-0 bg-danger text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>PID Loop</td>
<td></td>
<td></td>
<td></td>
<td><div class="p-2 mb-0 bg-danger text-white"></div></td>
<td><div class="p-2 mb-0 bg-danger text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Push to motors</td>
<td></td>
<td></td>
<td></td>
<td><div class="p-2 mb-0 bg-danger text-white"></div></td>
<td><div class="p-2 mb-0 bg-danger text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Calibration</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><div class="p-2 mb-0 bg-danger text-white"></div></td>
<td><div class="p-2 mb-0 bg-danger text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Prototyping</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Assemble prototype board</td>
<td></td>
<td></td>
<td></td>
<td><div class="p-2 mb-0 bg-info text-white"></div></td>
<td><div class="p-2 mb-0 bg-info text-white"></div></td>
<td><div class="p-2 mb-0 bg-info text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Physical drone assembly</td>
<td></td>
<td><div class="p-2 mb-0 bg-success text-white"></div></td>
<td><div class="p-2 mb-0 bg-success text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>3D printed mounts</td>
<td></td>
<td></td>
<td><div class="p-2 mb-0 bg-success text-white"></div></td>
<td><div class="p-2 mb-0 bg-success text-white"></div></td>
<td><div class="p-2 mb-0 bg-success text-white"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>PCB Design</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Schematic Design</td>
<td></td>
<td><div class="p-2 mb-0 bg-warning text-dark"></div></td>
<td><div class="p-2 mb-0 bg-warning text-dark"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>PCB Layout</td>
<td></td>
<td></td>
<td><div class="p-2 mb-0 bg-warning text-dark"></div></td>
<td><div class="p-2 mb-0 bg-warning text-dark"></div></td>
<td><div class="p-2 mb-0 bg-warning text-dark"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Verify / Order PCB</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><div class="p-2 mb-0 bg-warning text-dark"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Assemble PCB</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><div class="p-2 mb-0 bg-warning text-dark"></div></td>
<td><div class="p-2 mb-0 bg-warning text-dark"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Unit test PCB hardware</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><div class="p-2 mb-0 bg-warning text-dark"></div></td>
<td><div class="p-2 mb-0 bg-warning text-dark"></div></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Install PCB</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><div class="p-2 mb-0 bg-warning text-dark"></div></td>
<td><div class="p-2 mb-0 bg-warning text-dark"></div></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_schedule/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Power Budget</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg align-content-center">
<p>I created a more precise power budget for the particular components and subsystems within the PCB and larger system. I looked up ballpark values for large devices, made estimates, and looked at datasheets. Table 4.1 shows the resulting power budget.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="IMG_20220927_163218212_HDR.jpg" class="figure-img img-fluid rounded" alt="alt text" title="Initial sketch of power supply cascade"><figcaption class="figure-caption text-center" align="center">Initial sketch of power supply cascade</figcaption></figure></div></p>
</div>
<div class="col-lg align-content-center">
<style type="text/css">

</style>
<div class="d-flex justify-content-center">
<table>
<thead>
<tr>
<th>Supply</th>
<th>Device</th>
<th>Current Typ [mA]</th>
<th>Current Min [mA]</th>
<th>Current Max [mA]</th>
</tr>
</thead>
<tbody>
<tr>
<td>4S Battery</td>
<td>Motor controller(ESC)</td>
<td>400</td>
<td>400</td>
<td>400</td>
</tr>
<tr>
<td></td>
<td>Motors</td>
<td>26000</td>
<td>13000</td>
<td>38000</td>
</tr>
<tr>
<td></td>
<td>10V Supply</td>
<td>439.6</td>
<td>184.2</td>
<td>567.6</td>
</tr>
<tr>
<td>10V Supply</td>
<td>5V Supply</td>
<td>424.6</td>
<td>169.2</td>
<td>552.6</td>
</tr>
<tr>
<td></td>
<td>Power LED</td>
<td>15</td>
<td>15</td>
<td>15</td>
</tr>
<tr>
<td>5V Supply</td>
<td>Radio Receiver</td>
<td>3.4</td>
<td>3.4</td>
<td>3.4</td>
</tr>
<tr>
<td></td>
<td>Pi Zero</td>
<td>200</td>
<td>50</td>
<td>250</td>
</tr>
<tr>
<td></td>
<td>Camera</td>
<td>100</td>
<td>50</td>
<td>150</td>
</tr>
<tr>
<td></td>
<td>Power LED</td>
<td>15</td>
<td>15</td>
<td>15</td>
</tr>
<tr>
<td></td>
<td>3.3V Supply</td>
<td>106.2</td>
<td>50.8</td>
<td>134.2</td>
</tr>
<tr>
<td>3.3V Supply</td>
<td>STM32 Microcontroller</td>
<td>80</td>
<td>30</td>
<td>100</td>
</tr>
<tr>
<td></td>
<td>LSM6DSR 6-axis IMU</td>
<td>1.2</td>
<td>0.8</td>
<td>1.2</td>
</tr>
<tr>
<td></td>
<td>FT230XQ UART to USB</td>
<td>8</td>
<td>5</td>
<td>8</td>
</tr>
<tr>
<td></td>
<td>Power LED</td>
<td>15</td>
<td>15</td>
<td>15</td>
</tr>
<tr>
<td></td>
<td>RX/TX LED</td>
<td>2</td>
<td>0</td>
<td>10</td>
</tr>
<tr>
<td>Total Current [mA]</td>
<td></td>
<td>26839.6</td>
<td>13584.2</td>
<td>38967.6</td>
</tr>
<tr>
<td>Total Current [A]</td>
<td></td>
<td>26.84</td>
<td>13.58</td>
<td>38.97</td>
</tr>
</tbody>
</table>
</div>
<div class="d-flex justify-content-center">
Table 4.1. Power Budget Results
</div>
</div>
</div>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_power_budget/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Radio Integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg align-content-center">
<p>The first hurdle this week was getting the newly arrived radio transmitter and receiver to talk to each other and bind. They both use a newer air protocol called ELRS, or ExpressLRS. The receiver chosen uses an ESP8266, and is able to provide its own wireless access point to wirelessly login and configure the receiver through WiFi. The Transmitter is significantly more finicky, requiring a USB connection after a very precise power up sequence to be able to connect and configure it through a configurator.</p>
<p>To begin, I first soldered some wires to the receiver to be able to prototype with it. I used my favorite 30AWG wire, super thin and easy to work with.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk5/image.png" class="figure-img img-fluid rounded" alt="Alt text" title=" "><figcaption class="figure-caption text-center" align="center"> </figcaption></figure></div></p>
</div>
<div class="col-lg align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk5/image-1.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 5.1a,b. Wiring to radio receiver complete"><figcaption class="figure-caption text-center" align="center">Fig. 5.1a,b. Wiring to radio receiver complete</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Radio Integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg align-content-center">
<p>It soon became apparent that neither option worked, and after much debugging and hair pulling, I realized that the transmitter firmware is not being actively kept up to date with the version of software on the receiver – a big issue, as that means that the receiver is not trying to talk to the transmitter in an agreed upon format.</p>
<p>I discovered I needed to reflash the receiver with an older firmware version such that the TX and RX versions would match. Once I did this, they magically bound to each other, even though the version I flashed claimed to be the original source version the receiver came with. It was very strange.
In order to do all this, I powered the receiver from a USB to serial converter, and wired TX to RX so I could listen in on any debug output from the receiver in PuTTY. Once I finally got it to bind, I could look both in PuTTY and the oscilloscope and see packets arrive.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk5/image-7.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 5.6. Packet data streaming in from receiver in PuTTY after successful binding."><figcaption class="figure-caption text-center" align="center">Fig. 5.6. Packet data streaming in from receiver in PuTTY after successful binding.</figcaption></figure></div></p>
</div>
<div class="col-lg align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk5/image-6.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 5.5. Serial to USB converter wired to receiver."><figcaption class="figure-caption text-center" align="center">Fig. 5.5. Serial to USB converter wired to receiver.</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Radio Integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-7 align-content-center">
<p>Once binding was complete, the next goal was to attempt to parse the data and read the individual channels using an STM32. To get there, I first investigated the stream using PuTTY, an oscilloscope, logic analyzer, and recordings of serial data from PuTTY to find repeating sequences in the data.</p>
<p>Oscilloscope data can be seen in Fig. 5.7, with the scope locking onto a repeating packet of high baudrate serial data.</p>
<p>After determining the message format visually, I used the Waveforms program and the AD2 to decode the UART data from the receiver. Fig. 5.9 shows the AD2 decoding the 420KBaud UART data from the receiver, showing the 150Hz frame format.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk5/image-10.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 5.9. Decoded UART data from receiver in Waveforms."><figcaption class="figure-caption text-center" align="center">Fig. 5.9. Decoded UART data from receiver in Waveforms.</figcaption></figure></div></p>
</div>
<div class="col-lg-5 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk5/image-8.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 5.7. First look at serial data from receiver with oscilloscope."><figcaption class="figure-caption text-center" align="center">Fig. 5.7. First look at serial data from receiver with oscilloscope.</figcaption></figure></div></p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk5/image-9.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 5.8. Determining packet rate (150Hz) and decoding uart data with oscilloscope."><figcaption class="figure-caption text-center" align="center">Fig. 5.8. Determining packet rate (150Hz) and decoding uart data with oscilloscope.</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Radio Integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-8 align-content-center">
<p>Unfortunately, this protocol's only documentation is the source code that also utilizes this protocol, and to look at the raw data. Every packet seems to begin with a byte <code>0xC8</code>, followed by a byte <code>0x1B</code>, which seems to correspond to 2 less than the total length of the sequence. As one moves the sticks on the transmitter to get the packet data to change, a particular pair or so of bytes vary, but so do the final 2 bytes of the sequence. This, and reading code online, leads me to believe this is a 16 bit CRC of the transmitted sequence.</p>
<p>With this knowledge, I started writing code for the STM32 to interpret the incoming data. I modified my USB serial driver to be general, using <code>#define</code>s to determine the DMA channels, IO, GPIO banks, interrupts, etc. Then I used this code to set up a similar DMA driven system to pull in the bitstream from the receiver. I then wrote some simple channel interpretation code that watches for the initial byte <code>0xC8</code>, and then parses the indicated amount of data from the second byte. I then wired the ST Nucleo board up to the proper pins and powered the receiver from the Nucleo instead of the original setup with the USB to serial converter board.  Fig. 5.9 shows this new setup.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-14.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 5.11. Packets being received, and reported via UART to PC in PuTTY."><figcaption class="figure-caption text-center" align="center">Fig. 5.11. Packets being received, and reported via UART to PC in PuTTY.</figcaption></figure></div></p>
</div>
<div class="col-lg-4 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk5/image-12.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 5.9. ST Nucleo wired to receiver."><figcaption class="figure-caption text-center" align="center">Fig. 5.9. ST Nucleo wired to receiver.</figcaption></figure></div></p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk5/image-13.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 5.10. Closeup of receiver wiring."><figcaption class="figure-caption text-center" align="center">Fig. 5.10. Closeup of receiver wiring.</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Radio Integration</h1>
<div class="container align-content-center" style="height: 100%">
<p>Finally, after some reading of forums online, I heard the bit length of each channel’s data was 10 bits. I attempted to pull in channel data after the header 10 bits at a time, which showed some success, however the data kept rolling over, not going negative correctly, etc., which makes me think the bit offsets aren’t quite right. Online code also shows it to actually be 11 bits, which makes sense if that last bit is just the sign bit. I’ll be modifying my parsing code and the data should be coming properly very soon.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk5/image-15.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 5.12. Live plot of incoming channel data from transmitter control sticks, visible rollover, errors, and scaling errors."><figcaption class="figure-caption text-center" align="center">Fig. 5.12. Live plot of incoming channel data from transmitter control sticks, visible rollover, errors, and scaling errors.</figcaption></figure></div></p>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_radio/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Radio Integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-4 align-content-center">
<p><strong>Radio data parsing</strong></p>
<p>The first improvements done on the receiver code were proper interpretations of the channel bit data. They were actually 11 bit values rather than the 10 bits stated online. I assume this is just due to the sign bit and that is why it was not included. After creating a packed struct, the bits are easily extracted and the ensuing data could be extracted properly mapped to the correct channel.</p>
<p>To improve the existing radio receiver code, I had to put bounds on the input data streaming in. There were periodic packets coming in with valid frame starts, but with different content than channel data. This resulted in every 50 or so packets being invalid data, creating a useless and choppy input signal. To begin, I put a bound on the length of a packet before it gets parsed. If it fell within the valid range, it can then be processed.</p>
<p>The prior output of the parsing algorithm shows the clear issue:</p>
</div>
<div class="col-lg-8 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk6/image.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 6.1. Original throttle channel data showing periodic data corruption"><figcaption class="figure-caption text-center" align="center">Fig. 6.1. Original throttle channel data showing periodic data corruption</figcaption></figure></div></p>
<p>After properly filtering the packets to the proper data content, the data smoothly varies as expected.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk6/image-1.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 6.2. Correct output of all 8 channels after parsing improved."><figcaption class="figure-caption text-center" align="center">Fig. 6.2. Correct output of all 8 channels after parsing improved.</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Radio Integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-5 align-content-center">
<p><strong>Radio Code</strong></p>
<p>Finally, I overhauled my CRSF implementation from the original hacky demo to integrated and reliable firware – the original worked but performed almost no data validation (dangerous!), and was very inefficient.</p>
<p>For the new design, I chose a circular buffer, where the ‘start’ of the buffer would be shifted up until the end of the buffer, and then back around, rather than shifting the buffer contents while looking for a valid packet. This is significantly more efficient. Once it sees a valid starting character, it places a struct pointer at that location in memory, and begins to decode the data from that position, pulling out descriptors like the frame length from the point indicated my the struct definition. If needed, the ‘rolled over’ part of memory in the circular buffer is copied over to free space at the end of the buffer so the data frame is contiguous. Then the address, frame type, and CRC are checked. If these are valid, then the channel data is copied over to the global location for the latest radio channel data.</p>
</div>
<div class="col-lg-7 align-content-center">
<pre class="language-c"><code class="language-c">
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>crsf_addr_e<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">*</span>rx_buffer_start<span class="token punctuation">)</span> <span class="token operator">==</span> CRSF_ADDRESS_FLIGHT_CONTROLLER<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token comment">//go through and attempt to parse</span>
  <span class="token comment">//place the data struct at this location and see if it passes</span>
  <span class="token comment">//first task is to verify the length is within bounds, and</span>
  <span class="token comment">//that the message type is what we're looking for</span>
  <span class="token comment">//Then verify it has a valid CRC</span>

  <span class="token class-name">crsf_packet_t</span><span class="token operator">*</span> crsf_packet <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">crsf_packet_t</span><span class="token operator">*</span><span class="token punctuation">)</span>rx_buffer_start<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>crsf_packet<span class="token operator">-&gt;</span>header<span class="token punctuation">.</span>type <span class="token operator">==</span> CRSF_FRAMETYPE_RC_CHANNELS_PACKED<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>crsf_packet<span class="token operator">-&gt;</span>header<span class="token punctuation">.</span>frame_size <span class="token operator">==</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">crsf_channels_t</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">2</span><span class="token comment">/*type, crc, and payload*/</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">//validate CRC</span>

      <span class="token comment">//copy everything from bottom to the rx_buffer_start point into the </span>
      <span class="token comment">//upper half of the array to make it contiguous</span>
      <span class="token function">memcpy</span><span class="token punctuation">(</span>rx_buffer <span class="token operator">+</span> BUFFER_SIZE<span class="token punctuation">,</span> rx_buffer<span class="token punctuation">,</span> rx_buffer_start<span class="token operator">-</span>rx_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">uint8_t</span> calculated_crc <span class="token operator">=</span> <span class="token function">calc_crc</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>crsf_packet<span class="token operator">-&gt;</span>header<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">crsf_channels_t</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">uint8_t</span> rx_crc <span class="token operator">=</span> crsf_packet<span class="token operator">-&gt;</span>crc<span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>rx_crc <span class="token operator">==</span> calculated_crc<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">//valid packet</span>
        <span class="token comment">//TODO save the last 30 or so channel packets for filtering if needed</span>
        <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>saved_channel_data<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>crsf_packet<span class="token operator">-&gt;</span>channels<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">crsf_channels_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Radio Integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-5 align-content-center">
<p>This system actually worked almost perfectly first try, which was great! I only had to fix a couple pointer casts and offsets, and the system was good to go. Another benefit is I went to the source code on the ELRS site and used their #defines and enums, so that my code is using not only the right values, but the canonical names for each field.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk7/image-12.png" class="figure-img img-fluid rounded" alt="Alt text" title="Data streaming in"><figcaption class="figure-caption text-center" align="center">Data streaming in</figcaption></figure></div></p>
</div>
<div class="col-lg-7 align-content-center">
<pre class="language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{</span>
    <span class="token class-name">uint16_t</span> ch0 <span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">;</span>
    <span class="token class-name">uint16_t</span> ch1 <span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token class-name">uint16_t</span> ch14 <span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">;</span>
    <span class="token class-name">uint16_t</span> ch15 <span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>packed<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name">crsf_channels_t</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{</span>
    <span class="token class-name">uint8_t</span> device_addr<span class="token punctuation">;</span> <span class="token comment">// from crsf_addr_e</span>
    <span class="token class-name">uint8_t</span> frame_size<span class="token punctuation">;</span>  <span class="token comment">// counts size after this byte</span>
    <span class="token class-name">uint8_t</span> type<span class="token punctuation">;</span>        <span class="token comment">// from crsf_frame_type_e</span>
<span class="token punctuation">}</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>packed<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name">crsf_header_t</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{</span>
	<span class="token class-name">crsf_header_t</span> header<span class="token punctuation">;</span>
	<span class="token class-name">crsf_channels_t</span> channels<span class="token punctuation">;</span>
	<span class="token class-name">uint8_t</span> crc<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>packed<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name">crsf_packet_t</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">enum</span>
<span class="token punctuation">{</span>
    CRSF_FRAMETYPE_GPS <span class="token operator">=</span> <span class="token number">0x02</span><span class="token punctuation">,</span>
    CRSF_FRAMETYPE_BATTERY_SENSOR <span class="token operator">=</span> <span class="token number">0x08</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    CRSF_FRAMETYPE_MSP_RESP <span class="token operator">=</span> <span class="token number">0x7B</span><span class="token punctuation">,</span>  <span class="token comment">// reply with 58 byte chunked binary</span>
    CRSF_FRAMETYPE_MSP_WRITE <span class="token operator">=</span> <span class="token number">0x7C</span><span class="token punctuation">,</span> <span class="token comment">// write with 8 byte chunked binary</span>
<span class="token punctuation">}</span> crsf_frame_type_e<span class="token punctuation">;</span>
</code></pre>
<div class="text-muted text-center">Excerpt of CRSF header definitions</div>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">PWM Integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-5 align-content-center">
<p><strong>PWM development</strong></p>
<p>PWM is a very common protocol for controlling brushless ESCs. They commonly use a simple protocol of a 20ms period, and a pulse width varying from 1 to 2ms depending on throttle value (0% = 1ms, 100% = 2ms). A teammate had already created the driver code to produce this general signal, but it had to be implemented with the correct timing.</p>
<p>Some timing calculations had to be done to create a PWM signal working off of this code that had the correct pulse width and duty cycle. After refreshing myself about the internal timer operation, I created both code and an excel tool to calculate the PSC and ARR and CCMR values for the PWM driver.</p>
<div class="d-flex justify-content-center">
<table>
<thead>
<tr>
<th>PWM PSC &amp; ARR</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>period</td>
<td>0.02</td>
</tr>
<tr>
<td>Fclk</td>
<td>1.60E+07</td>
</tr>
<tr>
<td>freq</td>
<td>50</td>
</tr>
<tr>
<td>PSC</td>
<td>15</td>
</tr>
<tr>
<td>ARR</td>
<td>19999.00</td>
</tr>
<tr>
<td>freq_out</td>
<td>50</td>
</tr>
<tr>
<td>period_out</td>
<td>0.02</td>
</tr>
<tr>
<td>period_ms</td>
<td>20</td>
</tr>
</tbody>
</table>
</div>
<div class="d-flex justify-content-center">
Table 6.1. Table to calculate the registers.
</div>
</div>
<div class="col-lg-7 align-content-center">
<p>After calculating the proper register values, the oscilloscope data displays the desired PWM signal. As can be seen in Figure 6.3., the pulse width is the desired 20ms.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk6/image-2.png" class="figure-img img-fluid rounded" alt="Alt text" title="Figure 6.3. PWM pulse measured on oscilloscope."><figcaption class="figure-caption text-center" align="center">Figure 6.3. PWM pulse measured on oscilloscope.</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Radio and PWM integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-7 align-content-center">
<p><strong>Radio and PWM integration demo</strong></p>
<p>Now with both PWM and radio receiver working, I thought it would be a good demonstration, and also good work towards system integration, to make a radio channel value control the pulse width of the radio receiver. After changing some pins and channel values, and writing more configurable pin and register setup code, I was able to vary the pulse width by moving the sticks on the radio transmitter.</p>
<div id="zwQ3Dvz2RXk" class="eleventy-plugin-youtube-embed" style="position:relative;width:100%;padding-top: 56.25%;"><iframe style="position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;" width="100%" height="100%" frameborder="0" title="Embedded YouTube video" src="https://www.youtube-nocookie.com/embed/zwQ3Dvz2RXk" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
<div class="col-lg-5 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk6/image-4.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 6.4. Pulse width actively varied by radio receiver stick input."><figcaption class="figure-caption text-center" align="center">Fig. 6.4. Pulse width actively varied by radio receiver stick input.</figcaption></figure></div></p>
</div>
</div>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_radio_0/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Schematic</h1>
<div class="container align-content-center" style="height: 100%; width: 120%">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="ECE477_PCB.svg" class="figure-img img-fluid rounded" alt="alt text" title="Final schematic (IMU is on its own page)"><figcaption class="figure-caption text-center" align="center">Final schematic (IMU is on its own page)</figcaption></figure></div></p>
</div>
</div>
<!--
INSERT sections of schematic design
-->
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Schematic</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-5 align-content-center">
<p><strong>Power and status</strong></p>
<ul>
<li>Power is provided through ESC connector <code>J3</code></li>
<li>10V power is regulated down to 5V and then 3.3V</li>
<li>External power connector option available</li>
<li>Status LEDs for each supply</li>
</ul>
</div>
<div class="col-lg-7 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="svg/ECE477_PCB-cropped.svg" class="figure-img img-fluid rounded" alt="alt text" title="Power and status section"><figcaption class="figure-caption text-center" align="center">Power and status section</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Schematic</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-4 align-content-center">
<p><strong>USB UART</strong></p>
<ul>
<li>USB micro-B allowed easy serial connection to the flightcontroller</li>
<li>Small and configurable FT230XQ in QFP package supports power over USB and indicator LEDs</li>
</ul>
</div>
<div class="col-lg-8 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="svg/ECE477_PCB-cropped%20(1).svg" class="figure-img img-fluid rounded" alt="alt text" title="FTDI UART"><figcaption class="figure-caption text-center" align="center">FTDI UART</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Schematic</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-4 align-content-center">
<p><strong>STM32 and peripherals</strong></p>
<ul>
<li>STM32F446 220MHz CPU</li>
<li>Radio, Pi, and auxiliary UARTs</li>
<li>voltage sense</li>
<li>PWM outputs</li>
<li>reset, external crystal, cap banks</li>
</ul>
</div>
<div class="col-lg-8 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="svg/ECE477_PCB-cropped%20(2).svg" class="figure-img img-fluid rounded" alt="alt text" title="STM32"><figcaption class="figure-caption text-center" align="center">STM32</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Schematic</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-4 align-content-center">
<p><strong>LiDAR and backup motor drivers</strong></p>
<ul>
<li>I2C bus connections for LiDAR ToF sensors</li>
<li>backup brushed motor drivers using simple FET drivers
in case we had to abandon the brushless motors</li>
</ul>
</div>
<div class="col-lg-8 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="svg/ECE477_PCB-cropped%20(4).svg" class="figure-img img-fluid rounded" alt="alt text" title="LiDAR and brushed motors"><figcaption class="figure-caption text-center" align="center">LiDAR and brushed motors</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Schematic</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-7 align-content-center">
<p><strong>PCB Design</strong></p>
<p>As things move around, the optimal location to have the signal pins originate off the microcontroller can change. So, in addition to selecting optimal final locations for the components, I frequently checked the datasheet, and a handy ST tool to check which UARTs, SPI busses, etc. could be enabled on which IO pins. Using this, I could validate that my pin configuration was workable with my physical layout, and then implement that on my schematic.</p>
<p>Implementing the IMU was mildly interesting, as I want the capability to use either the MPU9250, the LSM6DS3, or both. So in addition to adding the recommended parts, caps, etc., I added a network of 0 ohm resistor switches to enable the desired configuration as needed.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk7/image-1.png" class="figure-img img-fluid rounded" alt="Alt text" title="Dual IMU configuration"><figcaption class="figure-caption text-center" align="center">Dual IMU configuration</figcaption></figure></div></p>
</div>
<div class="col-lg-5 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk7/image.png" class="figure-img img-fluid rounded" alt="Alt text" title="STM32F446 pin mappings"><figcaption class="figure-caption text-center" align="center">STM32F446 pin mappings</figcaption></figure></div></p>
</div>
</div>
</div>
</div>


<!--<img src=/engineering/drone/presentation/slide_schematic/ class="card-img-bottom" alt="..."> --><div class="carousel-item " style="height: 100%">
<h1 class="text-center mt-3">PCB design</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-6 ml-auto mr-auto align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk6/image015.png" class="figure-img img-fluid rounded" alt="alt text" title="Initial footprint positioning"><figcaption class="figure-caption text-center" align="center">Initial footprint positioning</figcaption></figure></div></p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk6/image017.png" class="figure-img img-fluid rounded" alt="alt text" title="Rendered view"><figcaption class="figure-caption text-center" align="center">Rendered view</figcaption></figure></div></p>
</div>
<div class="col-lg-1 ml-auto mr-auto align-content-center"></div>
<div class="col-lg-4 ml-auto mr-auto align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-3.png" class="figure-img img-fluid rounded" alt="alt text" title="Working on the FTDI section"><figcaption class="figure-caption text-center" align="center">Working on the FTDI section</figcaption></figure></div></p>
</div>
<div class="col-lg-1 ml-auto mr-auto align-content-center"></div>
</div>
</div>
</div>
<!--
INSERT PCB design section
-->
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">PCB design</h1>
<div class="container align-content-center" style="height: 100%">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="pcb.png" class="figure-img img-fluid rounded" alt="alt text" title="Kicad PCB view"><figcaption class="figure-caption text-center" align="center">Kicad PCB view</figcaption></figure></div></p>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">PCB design</h1>
<div class="container align-content-center" style="height: 100%">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="ECE477_PCB.png" class="figure-img img-fluid rounded" alt="alt text" title="3D render with part models"><figcaption class="figure-caption text-center" align="center">3D render with part models</figcaption></figure></div></p>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">PCB design</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-7 align-content-center">
<p>I also added the PI Zero connector that I had put off for last, selecting a part of the Pi header to interface to that contains the UART, +5V, and ground. This is pins 1 through 10 at the far edge of the PI PCB. This ended up being a relatively convenient spot after I moved a couple things out of its way.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk7/image-2.png" class="figure-img img-fluid rounded" alt="Alt text" title="Pi Zero pinout"><figcaption class="figure-caption text-center" align="center">Pi Zero pinout</figcaption></figure></div></p>
</div>
<div class="col-lg-5 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk7/image-3.png" class="figure-img img-fluid rounded" alt="Alt text" title="Pi Zero dimensions"><figcaption class="figure-caption text-center" align="center">Pi Zero dimensions</figcaption></figure></div></p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk7/image-4.png" class="figure-img img-fluid rounded" alt="Alt text" title="PCB drill and borders plot"><figcaption class="figure-caption text-center" align="center">PCB drill and borders plot</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">PCB design</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-6 align-content-center">
<p>Now that the part was in the ~mostly correct spot, I had to ensure that the connector would line up perfectly by looking up the exact dimensions of the board, and by verifying the setup by printing a to-scale version of the board and checking it against the Pi Zero I own.</p>
<p>Using these measurements, I worked to place it in what I believed was the best position. Then I printed off the to-scale version and compared. I noticed that while all the corner holes were properly aligned, the connector was about a millimeter too far to the right. I then readjusted and printed again. Much better! A visual check shows the pins at the exact right spot.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk7/image-6.png" class="figure-img img-fluid rounded" alt="Alt text" title="PCB size comparison"><figcaption class="figure-caption text-center" align="center">PCB size comparison</figcaption></figure></div></p>
</div>
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk7/image-5.png" class="figure-img img-fluid rounded" alt="Alt text" title="Pi zero with footprint printout"><figcaption class="figure-caption text-center" align="center">Pi zero with footprint printout</figcaption></figure></div></p>
</div>
</div>
</div>
</div>


<!--<img src=/engineering/drone/presentation/slide_pcb/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">IMU design and integration</h1>
<div class="container align-content-center" style="height: 100%">
<p><strong>IMU chips</strong></p>
<ul>
<li>I selected the LSM6SO for its cheapness and availability (this was during the chip shortage)</li>
<li>The MPU9250 is a tried and true part that I've worked with in the past and so was used to lower risk.</li>
<li>Both are SPI based MEMS IMU devices, interfaced via writing register table for configuration and polling for IMU data</li>
</ul>
<div class="row">
<div class="col-lg-5 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-1.png" class="figure-img img-fluid rounded" alt="alt text" title="MPU9250 block diagram"><figcaption class="figure-caption text-center" align="center">MPU9250 block diagram</figcaption></figure></div></p>
</div>
<div class="col-lg-7 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-2.png" class="figure-img img-fluid rounded" alt="alt text" title="LSM6DSO block diagram"><figcaption class="figure-caption text-center" align="center">LSM6DSO block diagram</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">IMU design and integration</h1>
<div class="container align-content-center" style="height: 100%">
<p><strong>Initial results</strong></p>
<p>The first objective after verifying my SPI bus driver was to begin streaming data off the devices, and tuning their configurations. Starting out, the data was too slow, and had the wrong bit format, but after fixing the bit shifting etc., and setting a higher data rate, it was clear all 6 axes were being properly read.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk10/image.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 10.1. 6 axes being read, accelerometer X,Y,Z, and gyro X, Y, Z."><figcaption class="figure-caption text-center" align="center">Fig. 10.1. 6 axes being read, accelerometer X,Y,Z, and gyro X, Y, Z.</figcaption></figure></div></p>
</div>
</div>
<!-- 
add in here some info about the SPI driver and initial dev?
-->
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">IMU design and integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-6 align-content-center">
<p><strong>IMU Calibration</strong></p>
<p>Next, all channels of the IMU must be calibrated so that the average value returned by the gyro for angular rate would be zero. Otherwise the integration of the angular rate to get heading would result in immediate drift and a useless measurement. Therefore, the system sums up for each axis a few thousand readings at reasonable time intervals, then divides that sum by the umber of samples to get the average reading. That is then subtracted from all future readings to get a zero mean angular rate reading.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk10/image-5.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 10.6. Integrated gyro heading data (before scaling applied)"><figcaption class="figure-caption text-center" align="center">Fig. 10.6. Integrated gyro heading data (before scaling applied)</figcaption></figure></div></p>
</div>
<div class="col-lg-6 align-content-center">
<pre class="language-c"><code class="language-c"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> CAL_LENGTH<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//set precise sampling interval</span>
		<span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">6.67f</span><span class="token operator">*</span><span class="token number">1000.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">read_axes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		gyro_cal_x <span class="token operator">+=</span> gyro_raw_x<span class="token punctuation">;</span>
		gyro_cal_y <span class="token operator">+=</span> gyro_raw_y<span class="token punctuation">;</span>
		gyro_cal_z <span class="token operator">+=</span> gyro_raw_z<span class="token punctuation">;</span>

		accel_cal_x <span class="token operator">+=</span> accel_raw_x<span class="token punctuation">;</span>
		accel_cal_y <span class="token operator">+=</span> accel_raw_y<span class="token punctuation">;</span>
		accel_cal_z <span class="token operator">+=</span> accel_raw_z <span class="token operator">-</span> A_RAW_1G<span class="token punctuation">;</span> <span class="token comment">//Z axis experiences gravity, this cals it to 1G</span>
	<span class="token punctuation">}</span>

	gyro_cal_x <span class="token operator">=</span> gyro_cal_x <span class="token operator">/</span> CAL_LENGTH<span class="token punctuation">;</span>
	gyro_cal_y <span class="token operator">=</span> gyro_cal_y <span class="token operator">/</span> CAL_LENGTH<span class="token punctuation">;</span>
	gyro_cal_z <span class="token operator">=</span> gyro_cal_z <span class="token operator">/</span> CAL_LENGTH<span class="token punctuation">;</span>

	accel_cal_x <span class="token operator">=</span> accel_cal_x <span class="token operator">/</span> CAL_LENGTH<span class="token punctuation">;</span>
	accel_cal_y <span class="token operator">=</span> accel_cal_y <span class="token operator">/</span> CAL_LENGTH<span class="token punctuation">;</span>
	accel_cal_z <span class="token operator">=</span> accel_cal_z <span class="token operator">/</span> CAL_LENGTH<span class="token punctuation">;</span></code></pre>
<p><em>Fig. 10.5. Calibration code</em></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">IMU design and integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-4 align-content-center">
<p>Once this was clearly working, I created a working timing driver to measure sub-millisecond time deltas as well as those with sub-millisecond fidelity but multi-millisecond span.</p>
<p>To do this, I combined the Systick timer’s countdown register, and a ‘tick’ variable incremented on every systick interrupt. I calculated the Systick roll-over value based on the clock frequency such that the interrupt occurs once every millisecond, giving a simple 1KHz timer.</p>
</div>
<div class="col-lg-8 align-content-center">
<pre class="language-c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">AHB_CLOCK</span> 		<span class="token expression">SystemCoreClock		</span><span class="token comment">//48 MHz</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">AHB_CLOCK_DIV_8</span> <span class="token expression"><span class="token punctuation">(</span>AHB_CLOCK<span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">)</span>	</span><span class="token comment">//6 MHz</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SYSTICK_INT_FREQ</span> <span class="token expression"><span class="token number">1000</span>			</span><span class="token comment">//1KHz desired interrupt frequency</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SYSTICK_LOAD</span>	<span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>AHB_CLOCK_DIV_8<span class="token operator">/</span>SYSTICK_INT_FREQ<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">void</span> <span class="token function">init_SYSTICK</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	SysTick<span class="token operator">-&gt;</span>LOAD <span class="token operator">=</span> SYSTICK_LOAD<span class="token punctuation">;</span>
	SysTick<span class="token operator">-&gt;</span>VAL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	SysTick<span class="token operator">-&gt;</span>CTRL <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	SysTick<span class="token operator">-&gt;</span>CTRL <span class="token operator">|=</span> <span class="token punctuation">(</span>SysTick_CTRL_TICKINT_Msk <span class="token operator">|</span> SysTick_CTRL_ENABLE_Msk<span class="token comment">/* | SysTick_CTRL_CLKSOURCE_Msk*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"SYSTICK:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\tSYSTICK_LOAD:		%d\n"</span><span class="token punctuation">,</span> SYSTICK_LOAD<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\tAHB_CLOCK:		%d\n"</span><span class="token punctuation">,</span> AHB_CLOCK<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\tAHB_CLOCK_DIV_8:	%d\n"</span><span class="token punctuation">,</span> AHB_CLOCK_DIV_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">IMU design and integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-4 align-content-center">
<p>To calculate inter-interrupt timing, I use the value of the systick down-counting register to determine how many decrements remain before rollover. When compared to the clock frequency (how many decrements per second), a floating point time in units of seconds can be calculated. I still need to determine however if fixed point math would be better suited to this though. The STM32F4 has an FPU to accelerate these calculations, although 32 bit fixed point may be better.</p>
<p>Once this was created, I could calculate the precise timestep between readings of the gyro data. This is crucial for accurate integration of the gyro angular rate data. Although much remains to be configured in terms of low pass filters, aliasing prevention, etc. I was able to obtain unit-correct heading data.</p>
</div>
<div class="col-lg-8 align-content-center">
<pre class="language-c"><code class="language-c"><span class="token class-name">uint32_t</span> ticks <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">SysTick_Handler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	ticks<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">float</span> <span class="token function">ftime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>ticks<span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>SYSTICK_INT_FREQ<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span>SYSTICK_LOAD<span class="token operator">-</span>SysTick<span class="token operator">-&gt;</span>VAL<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>AHB_CLOCK_DIV_8<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><em>Fig. 10.3. Code to calculated floating point timestamp in seconds.</em></p>
<pre class="language-c"><code class="language-c"><span class="token function">read_axes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

last_time <span class="token operator">=</span> current_time<span class="token punctuation">;</span>
current_time <span class="token operator">=</span> <span class="token function">ftime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gyro_rate_x <span class="token operator">=</span> <span class="token punctuation">(</span>gyro_raw_x <span class="token operator">-</span> gyro_cal_x<span class="token punctuation">)</span> <span class="token operator">*</span> G_GAIN_500DPS<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

gyro_angle_x <span class="token operator">+=</span> gyro_rate_x <span class="token operator">*</span> <span class="token punctuation">(</span>current_time <span class="token operator">-</span> last_time<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>
<p><em>Fig. 10.4. Code sample including LSB scaling and time delta.</em></p>
</div>
</div>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_imu/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">IMU design and integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-4 align-content-center">
<p><strong>Sensor fusion block diagram</strong></p>
<p>Once the basic function of streaming was complete, I put quite a bit of time into calibrating and adapting the IMU software to filter and combine the accelerometer and gyroscope.</p>
<p>The sensor fusion algorithm I settled on is composed of some initial filtering steps followed by a simple alpha/beta filter that combines the angular rate of the gyro with the high-noise but reliable accelerometer pitch and roll values. The alpha/beta parameter is also driven by a motion and noise sensing step to tune it to the most reliable sensor.</p>
</div>
<div class="col-lg-8 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-18.png" class="figure-img img-fluid rounded" alt="Alt text" title="Signal processing chain block diagram"><figcaption class="figure-caption text-center" align="center">Signal processing chain block diagram</figcaption></figure></div></p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-19.png" class="figure-img img-fluid rounded" alt="Alt text" title="IMU to motor output data flow"><figcaption class="figure-caption text-center" align="center">IMU to motor output data flow</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">IMU design and integration</h1>
<div class="container align-content-center" style="height: 100%">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-13.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-13. Normalized accelerometer data"><figcaption class="figure-caption text-center" align="center">Fig. 13-13. Normalized accelerometer data</figcaption></figure></div></p>
<div class="row">
<div class="col-lg-6 align-content-center">
<p>I created a very simple IIR filter for the accelerometer data, single pole:</p>
<p><mjx-container class="MathJax" jax="SVG" display="true" style="position: relative;"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="29.052ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 12840.9 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><defs><path id="MJX-2-TEX-I-1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-2-TEX-N-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path id="MJX-2-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-2-TEX-N-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path><path id="MJX-2-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-2-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path><path id="MJX-2-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-2-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-2-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-2-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-2-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-2-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D466" xlink:href="#MJX-2-TEX-I-1D466"></use></g><g data-mml-node="mo" transform="translate(490,0)"><use data-c="5B" xlink:href="#MJX-2-TEX-N-5B"></use></g><g data-mml-node="mi" transform="translate(768,0)"><use data-c="1D45B" xlink:href="#MJX-2-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(1368,0)"><use data-c="5D" xlink:href="#MJX-2-TEX-N-5D"></use></g><g data-mml-node="mo" transform="translate(1923.8,0)"><use data-c="3D" xlink:href="#MJX-2-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(2979.6,0)"><use data-c="1D458" xlink:href="#MJX-2-TEX-I-1D458"></use></g><g data-mml-node="mi" transform="translate(3500.6,0)"><use data-c="1D466" xlink:href="#MJX-2-TEX-I-1D466"></use></g><g data-mml-node="mo" transform="translate(3990.6,0)"><use data-c="5B" xlink:href="#MJX-2-TEX-N-5B"></use></g><g data-mml-node="mi" transform="translate(4268.6,0)"><use data-c="1D45B" xlink:href="#MJX-2-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(5090.8,0)"><use data-c="2212" xlink:href="#MJX-2-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(6091,0)"><use data-c="31" xlink:href="#MJX-2-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(6591,0)"><use data-c="5D" xlink:href="#MJX-2-TEX-N-5D"></use></g><g data-mml-node="mo" transform="translate(7091.2,0)"><use data-c="2B" xlink:href="#MJX-2-TEX-N-2B"></use></g><g data-mml-node="mo" transform="translate(8091.4,0)"><use data-c="28" xlink:href="#MJX-2-TEX-N-28"></use></g><g data-mml-node="mn" transform="translate(8480.4,0)"><use data-c="31" xlink:href="#MJX-2-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(9202.7,0)"><use data-c="2212" xlink:href="#MJX-2-TEX-N-2212"></use></g><g data-mml-node="mi" transform="translate(10202.9,0)"><use data-c="1D458" xlink:href="#MJX-2-TEX-I-1D458"></use></g><g data-mml-node="mo" transform="translate(10723.9,0)"><use data-c="29" xlink:href="#MJX-2-TEX-N-29"></use></g><g data-mml-node="mi" transform="translate(11112.9,0)"><use data-c="1D465" xlink:href="#MJX-2-TEX-I-1D465"></use></g><g data-mml-node="mo" transform="translate(11684.9,0)"><use data-c="5B" xlink:href="#MJX-2-TEX-N-5B"></use></g><g data-mml-node="mi" transform="translate(11962.9,0)"><use data-c="1D45B" xlink:href="#MJX-2-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(12562.9,0)"><use data-c="5D" xlink:href="#MJX-2-TEX-N-5D"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>=</mo><mi>k</mi><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>k</mi><mo stretchy="false">)</mo><mi>x</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container></p>
<p><mjx-container class="MathJax" jax="SVG" display="true" style="position: relative;"><svg style="vertical-align: -2.194ex;" xmlns="http://www.w3.org/2000/svg" width="28.743ex" height="5.498ex" role="img" focusable="false" viewBox="0 -1460 12704.3 2429.9" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><defs><path id="MJX-3-TEX-I-1D44C" d="M66 637Q54 637 49 637T39 638T32 641T30 647T33 664T42 682Q44 683 56 683Q104 680 165 680Q288 680 306 683H316Q322 677 322 674T320 656Q316 643 310 637H298Q242 637 242 624Q242 619 292 477T343 333L346 336Q350 340 358 349T379 373T411 410T454 461Q546 568 561 587T577 618Q577 634 545 637Q528 637 528 647Q528 649 530 661Q533 676 535 679T549 683Q551 683 578 682T657 680Q684 680 713 681T746 682Q763 682 763 673Q763 669 760 657T755 643Q753 637 734 637Q662 632 617 587Q608 578 477 424L348 273L322 169Q295 62 295 57Q295 46 363 46Q379 46 384 45T390 35Q390 33 388 23Q384 6 382 4T366 1Q361 1 324 1T232 2Q170 2 138 2T102 1Q84 1 84 9Q84 14 87 24Q88 27 89 30T90 35T91 39T93 42T96 44T101 45T107 45T116 46T129 46Q168 47 180 50T198 63Q201 68 227 171L252 274L129 623Q128 624 127 625T125 627T122 629T118 631T113 633T105 634T96 635T83 636T66 637Z"></path><path id="MJX-3-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-3-TEX-I-1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path><path id="MJX-3-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-3-TEX-I-1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path><path id="MJX-3-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path><path id="MJX-3-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-3-TEX-S4-2223" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z"></path><path id="MJX-3-TEX-I-1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path id="MJX-3-TEX-I-1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"></path><path id="MJX-3-TEX-I-1D714" d="M495 384Q495 406 514 424T555 443Q574 443 589 425T604 364Q604 334 592 278T555 155T483 38T377 -11Q297 -11 267 66Q266 68 260 61Q201 -11 125 -11Q15 -11 15 139Q15 230 56 325T123 434Q135 441 147 436Q160 429 160 418Q160 406 140 379T94 306T62 208Q61 202 61 187Q61 124 85 100T143 76Q201 76 245 129L253 137V156Q258 297 317 297Q348 297 348 261Q348 243 338 213T318 158L308 135Q309 133 310 129T318 115T334 97T358 83T393 76Q456 76 501 148T546 274Q546 305 533 325T508 357T495 384Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(264.5,710)"><g data-mml-node="mi"><use data-c="1D44C" xlink:href="#MJX-3-TEX-I-1D44C"></use></g><g data-mml-node="mo" transform="translate(763,0)"><use data-c="28" xlink:href="#MJX-3-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1152,0)"><use data-c="1D467" xlink:href="#MJX-3-TEX-I-1D467"></use></g><g data-mml-node="mo" transform="translate(1617,0)"><use data-c="29" xlink:href="#MJX-3-TEX-N-29"></use></g></g><g data-mml-node="mrow" transform="translate(220,-710)"><g data-mml-node="mi"><use data-c="1D44B" xlink:href="#MJX-3-TEX-I-1D44B"></use></g><g data-mml-node="mo" transform="translate(852,0)"><use data-c="28" xlink:href="#MJX-3-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1241,0)"><use data-c="1D467" xlink:href="#MJX-3-TEX-I-1D467"></use></g><g data-mml-node="mo" transform="translate(1706,0)"><use data-c="29" xlink:href="#MJX-3-TEX-N-29"></use></g></g><rect width="2295" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(2812.8,0)"><use data-c="3D" xlink:href="#MJX-3-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(3868.6,0)"><g data-mml-node="mi" transform="translate(3057.3,676)"><use data-c="1D458" xlink:href="#MJX-3-TEX-I-1D458"></use></g><g data-mml-node="mrow" transform="translate(220,-719.9)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(722.2,0)"><use data-c="2212" xlink:href="#MJX-3-TEX-N-2212"></use></g><g data-mml-node="mo" transform="translate(1722.4,0)"><use data-c="28" xlink:href="#MJX-3-TEX-N-28"></use></g><g data-mml-node="mn" transform="translate(2111.4,0)"><use data-c="31" xlink:href="#MJX-3-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(2833.7,0)"><use data-c="2212" xlink:href="#MJX-3-TEX-N-2212"></use></g><g data-mml-node="mi" transform="translate(3833.9,0)"><use data-c="1D458" xlink:href="#MJX-3-TEX-I-1D458"></use></g><g data-mml-node="mo" transform="translate(4354.9,0)"><use data-c="29" xlink:href="#MJX-3-TEX-N-29"></use></g><g data-mml-node="msup" transform="translate(4743.9,0)"><g data-mml-node="mi"><use data-c="1D467" xlink:href="#MJX-3-TEX-I-1D467"></use></g><g data-mml-node="TeXAtom" transform="translate(498,289) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><use data-c="2212" xlink:href="#MJX-3-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(778,0)"><use data-c="31" xlink:href="#MJX-3-TEX-N-31"></use></g></g></g></g><rect width="6395.6" height="60" x="120" y="220"></rect></g><g data-mml-node="msub" transform="translate(10504.1,0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mo"><svg width="278" height="2047" y="-773.5" x="27.5" viewBox="0 -253.6 278 2047"><use data-c="2223" xlink:href="#MJX-3-TEX-S4-2223" transform="scale(1,3.074)"></use></svg></g></g><g data-mml-node="TeXAtom" transform="translate(366,-808.9) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D467" xlink:href="#MJX-3-TEX-I-1D467"></use></g><g data-mml-node="mo" transform="translate(465,0)"><use data-c="3D" xlink:href="#MJX-3-TEX-N-3D"></use></g><g data-mml-node="msup" transform="translate(1243,0)"><g data-mml-node="mi"><use data-c="1D452" xlink:href="#MJX-3-TEX-I-1D452"></use></g><g data-mml-node="TeXAtom" transform="translate(499,289) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D457" xlink:href="#MJX-3-TEX-I-1D457"></use></g><g data-mml-node="mi" transform="translate(412,0)"><use data-c="1D714" xlink:href="#MJX-3-TEX-I-1D714"></use></g></g></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mrow><mi>Y</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><mrow><mi>X</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>=</mo><mfrac><mi>k</mi><mrow><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>k</mi><mo stretchy="false">)</mo><msup><mi>z</mi><mrow data-mjx-texclass="ORD"><mo>−</mo><mn>1</mn></mrow></msup></mrow></mfrac><msub><mrow data-mjx-texclass="ORD"><mo minsize="2.047em" maxsize="2.047em">|</mo></mrow><mrow data-mjx-texclass="ORD"><mi>z</mi><mo>=</mo><msup><mi>e</mi><mrow data-mjx-texclass="ORD"><mi>j</mi><mi>ω</mi></mrow></msup></mrow></msub></math></mjx-assistive-mml></mjx-container></p>
<p>I’ve plotted the frequency response of the filter (which isn’t amazing, but it runs pretty fast seeing as it’s single pole).</p>
</div>
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-4.png" class="figure-img img-fluid rounded" alt="alt text" title="Fig. 13-14. Frequency response of single pole IIR LPF, k=0.1,0.2,0.3"><figcaption class="figure-caption text-center" align="center">Fig. 13-14. Frequency response of single pole IIR LPF, k=0.1,0.2,0.3</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">IMU design and integration</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-9 align-content-center">
<p>I also created the conversion code from accelerometer g readings to estimated pitch and roll using the arctan function. The gravity vector is sensed by taking the dot product of the gravity vector and the axes of the accelerometer, giving 3 acceleration values. Assuming no other acceleration is present (haha like that’ll happen), the arctan function can be used to find the angle of the vector formed by the axes readings.</p>
<p><em>IIR filter implementation within atan2 conversion</em></p>
<pre class="language-cpp"><code class="language-cpp">accel_pitch <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span>accel_x<span class="token punctuation">,</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>accel_z<span class="token operator">*</span>accel_z <span class="token operator">+</span> accel_y<span class="token operator">*</span>accel_y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">180.0f</span><span class="token operator">/</span><span class="token number">3.1415963f</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.01f</span> <span class="token operator">+</span> <span class="token number">0.99f</span><span class="token operator">*</span>accel_pitch<span class="token punctuation">;</span>
accel_roll <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span>accel_y<span class="token punctuation">,</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>accel_z<span class="token operator">*</span>accel_z <span class="token operator">+</span> accel_x<span class="token operator">*</span>accel_x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">180.0f</span><span class="token operator">/</span><span class="token number">3.1415963f</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.01f</span> <span class="token operator">+</span> <span class="token number">0.99f</span><span class="token operator">*</span>accel_roll<span class="token punctuation">;</span></code></pre>
</div>
<div class="col-lg-3 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-20.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-16. How the gravity vector is applied across the axes of the accelerometer (source: Analog Devices)"><figcaption class="figure-caption text-center" align="center">Fig. 13-16. How the gravity vector is applied across the axes of the accelerometer (source: Analog Devices)</figcaption></figure></div></p>
</div>
</div>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-16.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-17. Pitch and roll after IIR and Atan2 computation"><figcaption class="figure-caption text-center" align="center">Fig. 13-17. Pitch and roll after IIR and Atan2 computation</figcaption></figure></div></p>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">IMU design and integration</h1>
<div class="container align-content-center" style="height: 100%">
<p>Lastly I implemented a filter called the complementary filter, which combines the high frequency gyroscope readings (which are reliable in the short term), and the noisy but long-term stable accelerometer angle, to compute a simple estimate of the true angle.</p>
<p>On top of that, I added an algorithm to modify in real time the parameter controlling the relative trust the complementary filter has in the gyro vs. the accelerometer. It works by sensing when the length of the vector comprising the total acceleration felt by the accelerometer is greater in magnitude than 1G, indicating that noise or movement is taking place. The differential is the used to generate a correction factor to apply to the parameter ‘Alpha’ which estimates which measurement is more accurate.</p>
<pre class="language-cpp"><code class="language-cpp">accel_pitch <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span>accel_x<span class="token punctuation">,</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>accel_z<span class="token operator">*</span>accel_z <span class="token operator">+</span> accel_y<span class="token operator">*</span>accel_y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">180.0f</span><span class="token operator">/</span><span class="token number">3.1415963f</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.01f</span> <span class="token operator">+</span> <span class="token number">0.99f</span><span class="token operator">*</span>accel_pitch<span class="token punctuation">;</span>
accel_roll <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span>accel_y<span class="token punctuation">,</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>accel_z<span class="token operator">*</span>accel_z <span class="token operator">+</span> accel_x<span class="token operator">*</span>accel_x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">180.0f</span><span class="token operator">/</span><span class="token number">3.1415963f</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.01f</span> <span class="token operator">+</span> <span class="token number">0.99f</span><span class="token operator">*</span>accel_roll<span class="token punctuation">;</span>

<span class="token keyword">float</span> alpha_correction <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>total_acceleration_filtered<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">float</span> ALPHA <span class="token operator">=</span> <span class="token punctuation">(</span>ALPHA_0 <span class="token operator">+</span> alpha_correction<span class="token punctuation">)</span><span class="token punctuation">;</span>

compl_pitch <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token operator">-</span>ALPHA<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>gyro_rate_y<span class="token operator">*</span><span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>current_time <span class="token operator">-</span> last_time<span class="token punctuation">)</span> <span class="token operator">+</span> ALPHA <span class="token operator">*</span> <span class="token punctuation">(</span>accel_pitch<span class="token operator">-</span>compl_pitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
compl_roll <span class="token operator">+=</span>  <span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token operator">-</span>ALPHA<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>gyro_rate_x<span class="token operator">*</span><span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>current_time <span class="token operator">-</span> last_time<span class="token punctuation">)</span> <span class="token operator">+</span> ALPHA <span class="token operator">*</span> <span class="token punctuation">(</span>accel_roll<span class="token operator">-</span>compl_roll<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<div class="text-center text-muted">Fig. 15- 1. Source code of filter correction algorithm</div>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-17.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-19. Angle estimation using complementary filter, demonstrates no drift, and good noise tolerance"><figcaption class="figure-caption text-center" align="center">Fig. 13-19. Angle estimation using complementary filter, demonstrates no drift, and good noise tolerance</figcaption></figure></div></p>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">IMU design and integration</h1>
<div class="container align-content-center" style="height: 100%">
<div id="g4PSVRbhDk8" class="eleventy-plugin-youtube-embed" style="position:relative;width:100%;padding-top: 56.25%;"><iframe style="position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;" width="100%" height="100%" frameborder="0" title="Embedded YouTube video" src="https://www.youtube-nocookie.com/embed/g4PSVRbhDk8" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_imu_0/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Frame, motors &amp; ESCs</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-4 align-content-center">
<p><strong>Mechanical assembly</strong></p>
<p>As the flight controller development continues, I completed the wiring of the motors and ESC, along with the battery, as that has arrived as well. Soldering anything to the ESC is a bit of a challenge, as the heat dissipation and thermal mass of the board is so high. I have to set the temperature of the iron past 900 deg.F, and that seems to work alright. I started out by wrapping the motor cables around the arms of the frame to take up the slack in the cables, but allow for rewiring and flexing of the cable. I taped them in their positions, and then worked on mounting the ESC to the frame.</p>
</div>
<div class="col-lg-8 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk11/image.png" class="figure-img img-fluid rounded" alt="Alt text" title="Figure 11- 1. Motor cables arranged before soldering."><figcaption class="figure-caption text-center" align="center">Figure 11- 1. Motor cables arranged before soldering.</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Frame, motors &amp; ESCs</h1>
<div class="container align-content-center" style="height: 100%">
<p>The ESC wasn’t hard to mount, it simply needed ¾” M3 screws and nuts to hold it in place.
Once the ESC was mounted, I soldered the power cable, and then the motors. Once complete, I powered it up and verified that each motor vibrated as it generated the startup sound.</p>
<div class="row">
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk11/image-2.png" class="figure-img img-fluid rounded" alt="Alt text" title="Figure 11- 3a. Battery cables soldered"><figcaption class="figure-caption text-center" align="center">Figure 11- 3a. Battery cables soldered</figcaption></figure></div></p>
</div>
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk11/image-4.png" class="figure-img img-fluid rounded" alt="Alt text" title="Figure 11- 3b. ESC fully soldered."><figcaption class="figure-caption text-center" align="center">Figure 11- 3b. ESC fully soldered.</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Frame, motors &amp; ESCs</h1>
<div class="container align-content-center" style="height: 100%">
<p><strong>Flight Controller Mount Design</strong></p>
<p>I decided to model everything in Inventor including the Pi Zero and the PCB, so I spent quite a bit of time figuring out how to export a model from KiCAD that Inventor could understand without it losing a significant amount of information. I also added the screws and nuts that we will use, both because I think it looks nice, and it makes sure that each part has the needed clearance to be screwed in.</p>
<div class="row">
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk12/image-3.png" class="figure-img img-fluid rounded" alt="Alt text" title="PCB stack bracket"><figcaption class="figure-caption text-center" align="center">PCB stack bracket</figcaption></figure></div></p>
</div>
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk12/image-4.png" class="figure-img img-fluid rounded" alt="Alt text" title="View underneath with PCBs"><figcaption class="figure-caption text-center" align="center">View underneath with PCBs</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Frame, motors &amp; ESCs</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk12/image-7.png" class="figure-img img-fluid rounded" alt="Alt text" title="Perspective view"><figcaption class="figure-caption text-center" align="center">Perspective view</figcaption></figure></div></p>
</div>
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk12/image-8.png" class="figure-img img-fluid rounded" alt="Alt text" title="Full chassis view"><figcaption class="figure-caption text-center" align="center">Full chassis view</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Frame, motors &amp; ESCs</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-5 align-content-center">
<p>Once the mounting bracket was printed, I tried it out to see if it needed any changes/reprint. After removing the raft and support material, and cleaning off the thin wisps of print material, the bracket was looking good.</p>
<p>An initial evaluation revealed however that I had forgotten a couple very important components when designing this, the motor cables and the motor controller clearance. As can be seen in Fig. 7, the bracket doesn’t leave any space between the screw holes for the motor cables to pass under, as well as coming real close to the top of the motor controller.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-6.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-6. Flight controller mounting bracket after printing"><figcaption class="figure-caption text-center" align="center">Fig. 13-6. Flight controller mounting bracket after printing</figcaption></figure></div></p>
</div>
<div class="col-lg-7 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-7.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-7. Clearance and cable issues with flight controller mount"><figcaption class="figure-caption text-center" align="center">Fig. 13-7. Clearance and cable issues with flight controller mount</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Frame, motors &amp; ESCs</h1>
<div class="container align-content-center" style="height: 100%">
<p>These issues didn’t seem to be solvable without damaging the mount, or modification of the motor cable routing (which I definitely didn’t want to change), so I decided to make some modifications and reprint.</p>
<p>I fixed both issues by extruding the part of the bracket that surrounds the mounting screws, but leaving space for the motor cables – this increased the clearance while making space for the wires, solving both issues.</p>
<div class="row">
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-9.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-8. Edited bracket after changes"><figcaption class="figure-caption text-center" align="center">Fig. 13-8. Edited bracket after changes</figcaption></figure></div></p>
</div>
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-10.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-9. Fixed bracket in place within assembly"><figcaption class="figure-caption text-center" align="center">Fig. 13-9. Fixed bracket in place within assembly</figcaption></figure></div></p>
</div>
</div>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_motors_frame/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">PCB Assembly</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-5 align-content-center">
<p>Our PCBs arrived this week from JLCPCB, allowing us to start the hardware build process. The boards look good, however not tenting the vias is going to make certain aspects of the board much harder to solder, on an already very dense and small pitch build. We’ll see how this goes. Figure 11- 1 shows one of the boards upon arrival.</p>
<p>First, I wanted to perform some electrical tests on the board, which it passed. I tested continuity for many different nets, particularly those with very tight trace tolerances. Next I tested the physical layout of the board by comparing it to the Pi Zero, onto which it needs to mount. I was happy to see the boards fit perfectly with the Pi Zero form factor and screw positions, as well as the communication connector lining right up with the Pi Zero header.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk11/image-5.png" class="figure-img img-fluid rounded" alt="Alt text" title="Figure 11- 4. Newly arrived boards."><figcaption class="figure-caption text-center" align="center">Figure 11- 4. Newly arrived boards.</figcaption></figure></div></p>
</div>
<div class="col-lg-7 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk11/image-6.png" class="figure-img img-fluid rounded" alt="Alt text" title="Figure 11- 5. Blank board with Pi Zero"><figcaption class="figure-caption text-center" align="center">Figure 11- 5. Blank board with Pi Zero</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">PCB Assembly</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-6 align-content-center">
<p>Once satisfied that the boards weren’t total trash, I began soldering, starting with the power supply, to verify that first. This board uses mostly 0603 SMT passive components, with a couple 0402s and 1206 &amp; 1210s for power capacitors. This means the lab doesn’t have the majority of the components we need. Thankfully, I have a personal stockpile of a variety of different 0603 SMT passives, and a few assorted 1206 &amp; 1210s from previous flight controller board projects.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk11/image-7.png" class="figure-img img-fluid rounded" alt="Alt text" title="Figure 11- 6. Stockpile of various 0603 passives, and a few hard to find chips. (FT230XQ and MPU9250)"><figcaption class="figure-caption text-center" align="center">Figure 11- 6. Stockpile of various 0603 passives, and a few hard to find chips. (FT230XQ and MPU9250)</figcaption></figure></div></p>
</div>
<div class="col-lg-6 align-content-center">
<p>I first laid out the components on the board without soldering, to get a sense of how everything was fitting, and if there were any mistakes with footprints. I then went into KiCAD and generated a plot of the reference designator and value of every component on the board, at much larger scale. This helps a lot when trying to figure out which miniscule SMT part goes where</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk11/image-8.png" class="figure-img img-fluid rounded" alt="Alt text" title="Figure 11- 7. Plot of value, ref. designator pairs to help with soldering."><figcaption class="figure-caption text-center" align="center">Figure 11- 7. Plot of value, ref. designator pairs to help with soldering.</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">PCB Assembly</h1>
<div class="container align-content-center" style="height: 100%">
<p>First I soldered the power capacitors, 5V switching regulator, and then the ESC connector. I then tested the regulator by wiring the connector to the ESC and powering on, and measuring the voltage and ripple.</p>
<p>After this, I added all the 3.3V microcontroller caps, and then the microcontroller. This is one of the most difficult parts to solder, and definitely took a while. First I covered the board in flux, and brushed solder across the pads. Then I tacked a pin from each corner down, and then dragged the tinned iron across the pins. Next I added the programming header. At first this appeared to work, but after attempting to program with no success, I realized that some of the solder joints on the micro had very little solder, so I reheated multiple joints individually, and then the device was able to program.</p>
<div class="row">
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk11/image-15.png" class="figure-img img-fluid rounded" alt="Alt text" title="Figure 11- 10. Closeup of board after micro soldered."><figcaption class="figure-caption text-center" align="center">Figure 11- 10. Closeup of board after micro soldered.</figcaption></figure></div></p>
</div>
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk11/image-16.png" class="figure-img img-fluid rounded" alt="Alt text" title="Figure 11- 11. Board running 'blink LED' test while powered by ESC."><figcaption class="figure-caption text-center" align="center">Figure 11- 11. Board running 'blink LED' test while powered by ESC.</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">PCB Assembly</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-4 align-content-center">
<p>After my less than excellent progress bricking a chip trying to get the IMU working, I decided to use the hot plate and reflow the entire top of the PCB in one shot. (Unfortunately, I didn’t get pictures of the stencil and reflow process, I was a little rushed) I started by organizing all the parts on a printout I developed last time to help place the parts with the right values in the right spots.</p>
<p>The stencil we purchased with our board came as a very large thin sheet of metal, with the small cutouts for our board in the center. This was way too large as is, cut it down to size first with a sheet cutter. With the stencil ready, I set up the board to be stenciled by using a metal right-angle of equal thickness to the PCB to secure the PCB on the table, and then taped the stencil down onto the PCB like a hinge.</p>
<p>Then I took the PCB with paste back to my station, and carefully placed each part onto it’s pads with tweezers, carefully aligning and double-checking them. Once I was confident the placement was correct and aligned, Joe helped me use the (very hot) hot plate to preheat my PCB, and then reflow the paste on the PCB. It was very cool to see the paste boil, the solder melt, and all the components float into place as the solder glistens. After the PCB cooled down, I washed it off and took a look at the results.</p>
</div>
<div class="col-lg-8 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-1. Parts layout before placement"><figcaption class="figure-caption text-center" align="center">Fig. 13-1. Parts layout before placement</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">PCB Assembly</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-6 align-content-center">
<p>Nearly all the components were soldered correctly, but both IMUs, the micro, and the USB connector had shorts due to excess solder paste. The IMU joints were easy to clear, but the micro was surprisingly difficult. Joe had to help me clear them, but afterwards it looked quite nice. The USB was the most frustrating, as it had bridged ID and ground, and VUSB and ground. Anything shorted to ground on the USB connector is difficult to fix, as the USB connector sucks all the heat away as the iron tries to melt the joints. ID I left shorted, as the board doesn’t use it and the bus doesn’t care, but I was able to successfully clear the bridge with VUSB with lots of heat and flux.</p>
<p>Once the top of the PCB was complete, I went back and hand-soldered each cap onto the back of the PCB. This was pretty easy after doing the first board thankfully. After adding the 3.3V regulator, the board was ready to test.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-1.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-2. PCB after reflow, note shorts on multiple parts"><figcaption class="figure-caption text-center" align="center">Fig. 13-2. PCB after reflow, note shorts on multiple parts</figcaption></figure></div></p>
</div>
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-2.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-3. PCB after shorts fixed."><figcaption class="figure-caption text-center" align="center">Fig. 13-3. PCB after shorts fixed.</figcaption></figure></div></p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-3.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-4. Back side of PCB after hand-soldering all caps and regulator."><figcaption class="figure-caption text-center" align="center">Fig. 13-4. Back side of PCB after hand-soldering all caps and regulator.</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">PCB Assembly</h1>
<div class="container align-content-center" style="height: 100%">
<p>Testing simply consisted of lots of continuity checks (and checks for shorts), and powering the board from the 3.3V supply on the programmer. With LEDs coming on properly, I programmed the board successfully with a ‘blink LED’ test program and then proceeded to test the USB-serial as well. Surprisingly, all hardware, even the IMU, worked first try. Good stuff.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-5.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 13-5. Power-up and testing of USB->Serial"><figcaption class="figure-caption text-center" align="center">Fig. 13-5. Power-up and testing of USB-&gt;Serial</figcaption></figure></div></p>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_pcb_buildup/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">ESCs &amp; motors</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-6 align-content-center">
<p>This week I also switched to using OneShot125 correctly and running it at maximum data rate, around 3.8kHz, rather than the previous 400Hz.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk15/wavedrom_oneshot.png" class="figure-img img-fluid rounded" alt="alt text" title="Fig. 15- 20. Oneshot125 Timing diagram."><figcaption class="figure-caption text-center" align="center">Fig. 15- 20. Oneshot125 Timing diagram.</figcaption></figure></div></p>
<p>After testing the PID loops with the motors running, and readying the drone for test flights, I needed to ensure that the propellers on the drone were spinning the correct direction. The torque induced from the motors rotating is very significant, and if the motors spin the wrong direction this torque will not be counteracted and will spin the drone out of control.</p>
<p>For this reason, half the motors have to spin counterclockwise and half clockwise. However, if just any two are chosen, then when the drone attempts to counteract an imbalance in pitch or roll, it may change the speeds of the motor pair that spins in the same direction, resulting in a torque differential, and then spin. Thus, it must have the motors on a diagonal with each other spin in the same direction. Thus when any pair of motors on a side changes speeds, both the CCW spinning motor and the CW spinning motor will change speeds equally, resulting in net zero torque.</p>
</div>
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk15/config1.png" class="figure-img img-fluid rounded" alt="alt text" title="Fig. 15- 21. BLHeli_32 Configurator"><figcaption class="figure-caption text-center" align="center">Fig. 15- 21. BLHeli_32 Configurator</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">ESCs &amp; motors</h1>
<div class="container align-content-center" style="height: 100%">
<div id="4aSOW4n8nL4" class="eleventy-plugin-youtube-embed" style="position:relative;width:100%;padding-top: 56.25%;"><iframe style="position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;" width="100%" height="100%" frameborder="0" title="Embedded YouTube video" src="https://www.youtube-nocookie.com/embed/4aSOW4n8nL4" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">ESCs &amp; motors</h1>
<div class="container align-content-center" style="height: 100%">
<p>With the motors and IMU now all working, I tried running the full PID loop + motor + radio code to test the response of the drone. Unfortunately, I noticed immediately that there was a huge issue with the noise induced in the data by the vibration from the motors running.
I took a look at the noise spectrum while the motors were running, hoping all the noise was high frequency, or tonal and could be filtered, however it was broadband, and the gyro was hitting its max dynamic range as well.</p>
<p>As evidence of all this, with the motors running and the drone still, the pitch and roll quickly diverged from an accurate measurement of the heading.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk15/image-3.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 4. Very messed up gyro readings"><figcaption class="figure-caption text-center" align="center">Fig. 15- 4. Very messed up gyro readings</figcaption></figure></div></p>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">ESCs &amp; motors</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-8 align-content-center">
<p>In order to fix the vibration issues, I had to use an alternate mount to the original rigid mounting setup. I found a piece of soft anti-static foam, and glued the 3D printed mount onto the foam, and then onto the motor controller.</p>
<p>I initially just tried using O-rings at the mount points, however this wasn’t sufficient.</p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk15/image-4.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 5. Trying to use O-rings to damped vibration"><figcaption class="figure-caption text-center" align="center">Fig. 15- 5. Trying to use O-rings to damped vibration</figcaption></figure></div></p>
</div>
<div class="col-lg-4 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk15/image-5.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 6. Trying out foam"><figcaption class="figure-caption text-center" align="center">Fig. 15- 6. Trying out foam</figcaption></figure></div></p>
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk15/image-7.png" class="figure-img img-fluid rounded" alt="Alt text" title="Fig. 15- 8. Trying foam and rubber mounts"><figcaption class="figure-caption text-center" align="center">Fig. 15- 8. Trying foam and rubber mounts</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">ESCs &amp; motors</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-2 align-content-center"></div>
<div class="col-lg-8 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk13/image-19.png" class="figure-img img-fluid rounded" alt="Alt text" title="IMU to motor output data flow"><figcaption class="figure-caption text-center" align="center">IMU to motor output data flow</figcaption></figure></div></p>
</div>
<div class="col-lg-2 align-content-center"></div>
</div>
<div class="row">
<div class="col-lg-6 align-content-center">
<pre class="language-c"><code class="language-c"><span class="token keyword">float</span> <span class="token function">update_PID</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">PID</span><span class="token operator">*</span> pid<span class="token punctuation">,</span> <span class="token keyword">float</span> real<span class="token punctuation">,</span> <span class="token keyword">float</span> desired<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	pid<span class="token operator">-&gt;</span>Error <span class="token operator">=</span> desired <span class="token operator">-</span> real<span class="token punctuation">;</span>

	pid<span class="token operator">-&gt;</span>P_Error <span class="token operator">=</span> <span class="token function">bound</span><span class="token punctuation">(</span> pid<span class="token operator">-&gt;</span>Error <span class="token operator">*</span> pid<span class="token operator">-&gt;</span>kP<span class="token punctuation">,</span> pid<span class="token operator">-&gt;</span>maxP<span class="token punctuation">)</span><span class="token punctuation">;</span>
	pid<span class="token operator">-&gt;</span>I_Error <span class="token operator">=</span> <span class="token function">bound</span><span class="token punctuation">(</span> pid<span class="token operator">-&gt;</span>I_Error <span class="token operator">+</span> <span class="token punctuation">(</span>pid<span class="token operator">-&gt;</span>Error<span class="token punctuation">)</span><span class="token operator">*</span>pid<span class="token operator">-&gt;</span>kI<span class="token punctuation">,</span> pid<span class="token operator">-&gt;</span>maxI<span class="token punctuation">)</span><span class="token punctuation">;</span>
	pid<span class="token operator">-&gt;</span>D_Error <span class="token operator">=</span> <span class="token function">bound</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pid<span class="token operator">-&gt;</span>Error <span class="token operator">-</span> pid<span class="token operator">-&gt;</span>Last_Error<span class="token punctuation">)</span><span class="token operator">*</span>pid<span class="token operator">-&gt;</span>kD<span class="token punctuation">,</span> pid<span class="token operator">-&gt;</span>maxD<span class="token punctuation">)</span><span class="token punctuation">;</span>

	pid<span class="token operator">-&gt;</span>Output <span class="token operator">=</span>  pid<span class="token operator">-&gt;</span>P_Error<span class="token punctuation">;</span>
	pid<span class="token operator">-&gt;</span>Output <span class="token operator">+=</span> pid<span class="token operator">-&gt;</span>I_Error<span class="token punctuation">;</span>
	pid<span class="token operator">-&gt;</span>Output <span class="token operator">+=</span> pid<span class="token operator">-&gt;</span>D_Error<span class="token punctuation">;</span>

	pid<span class="token operator">-&gt;</span>Last_Error <span class="token operator">=</span> pid<span class="token operator">-&gt;</span>Error<span class="token punctuation">;</span>
	pid<span class="token operator">-&gt;</span>Last_Output <span class="token operator">=</span> pid<span class="token operator">-&gt;</span>Output<span class="token punctuation">;</span>

	<span class="token keyword">return</span> pid<span class="token operator">-&gt;</span>Output<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>
<div class="col-lg-6 align-content-center">
<div id="K2zn1jZydOI" class="eleventy-plugin-youtube-embed" style="position:relative;width:100%;padding-top: 56.25%;"><iframe style="position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;" width="100%" height="100%" frameborder="0" title="Embedded YouTube video" src="https://www.youtube-nocookie.com/embed/K2zn1jZydOI" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">ESCs &amp; motors</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-6 align-content-center">
<p>Boot log:</p>
<pre class="language-c"><code class="language-c"><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
ECE477 STM32F446RET6 Flight Controller V0
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>

USB_USART<span class="token operator">:</span>
	USB_USART_BAUDRATE<span class="token operator">:</span>      <span class="token number">115200</span>
	CLOCK_RATE<span class="token operator">:</span>              <span class="token number">90000000</span>
	USB_USART_CLOCK_RATE<span class="token operator">:</span>    <span class="token number">90000000</span>
	USB_USART_DIV<span class="token operator">:</span>           <span class="token number">48</span>
	USB_USART_DIV_FRACTION<span class="token operator">:</span>  <span class="token number">13</span>
	USB_USART_DIV_MANTISSA<span class="token operator">:</span>  <span class="token number">48</span>
SYSTICK<span class="token operator">:</span>
	SYSTICK_LOAD<span class="token operator">:</span>		<span class="token number">22499</span>
	AHB_CLOCK<span class="token operator">:</span>		<span class="token number">180000000</span>
	AHB_CLOCK_DIV_8<span class="token operator">:</span>	<span class="token number">22500000</span>
RX_USART<span class="token operator">:</span>
	RX_USART_BAUDRATE<span class="token operator">:</span>      <span class="token number">420000</span>
	CLOCK_RATE<span class="token operator">:</span>             <span class="token number">90000000</span>
	RX_USART_CLOCK_RATE<span class="token operator">:</span>    <span class="token number">90000000</span>
	RX_USART_DIV<span class="token operator">:</span>           <span class="token number">13</span>
	RX_USART_DIV_FRACTION<span class="token operator">:</span>  <span class="token number">6</span>
	RX_USART_DIV_MANTISSA<span class="token operator">:</span>  <span class="token number">13</span>
	CRSF_RX_BAUDRATE<span class="token operator">:</span>       <span class="token number">420000</span>
	CRSF_NUM_CHANNELS<span class="token operator">:</span>      <span class="token number">16</span>
	CRSF_CHANNEL_VALUE_MIN<span class="token operator">:</span> <span class="token number">172</span>
	CRSF_CHANNEL_VALUE_MID<span class="token operator">:</span> <span class="token number">992</span>
	CRSF_CHANNEL_VALUE_MAX<span class="token operator">:</span> <span class="token number">1811</span>
	CRSF_MAX_PACKET_LEN<span class="token operator">:</span>    <span class="token number">64</span></code></pre>
</div>
<div class="col-lg-6 align-content-center">
<p><em>(Continued...)</em></p>
<pre class="language-c"><code class="language-c">PI_USART<span class="token operator">:</span>
	PI_USART_BAUDRATE<span class="token operator">:</span>      <span class="token number">115200</span>
	CLOCK_RATE<span class="token operator">:</span>             <span class="token number">45000000</span>
	PI_USART_CLOCK_RATE<span class="token operator">:</span>    <span class="token number">45000000</span>
	PI_USART_DIV<span class="token operator">:</span>           <span class="token number">24</span>
	PI_USART_DIV_FRACTION<span class="token operator">:</span>  <span class="token number">6</span>
	PI_USART_DIV_MANTISSA<span class="token operator">:</span>  <span class="token number">24</span>
	PI_FRAME_START_CODE<span class="token operator">:</span>    <span class="token number">65</span>
	PI_FRAME_END_CODE<span class="token operator">:</span>      <span class="token number">66</span>
PWM<span class="token operator">:</span>
	PWM_FREQ<span class="token operator">:</span>        <span class="token number">3800</span>
	PWM_PERIOD <span class="token punctuation">[</span>uS<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">263.157898</span>
	MIN_PULSE  <span class="token punctuation">[</span>uS<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">125</span>
	MAX_PULSE  <span class="token punctuation">[</span>uS<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">250</span>
	PWM_ARR<span class="token operator">:</span>         <span class="token number">5262</span>
	UPPERBOUNDCRRX<span class="token operator">:</span>  <span class="token number">5000</span>
	LOWERBOUNDCRRX<span class="token operator">:</span>  <span class="token number">2500</span>
	RANGE<span class="token operator">:</span>           <span class="token number">2500</span>
SPI1<span class="token operator">:</span>
	SPI_CR1_BR_PCLOCK_DIV_32<span class="token operator">:</span> <span class="token number">0x20</span>
	SPI_PCLOCK_DIV_32<span class="token operator">:</span>        <span class="token number">2812500</span>
LSM6DSO Calibration<span class="token operator">:</span>
	gyro_cal_x<span class="token operator">:</span> <span class="token number">4</span>
	gyro_cal_y<span class="token operator">:</span> <span class="token number">14</span>
	gyro_cal_z<span class="token operator">:</span> <span class="token number">0</span>
MPU6500 Calibration<span class="token operator">:</span>
	gyro_cal_x<span class="token operator">:</span> <span class="token number">6419</span>
	gyro_cal_y<span class="token operator">:</span> <span class="token number">5340</span>
	gyro_cal_z<span class="token operator">:</span> <span class="token number">0</span></code></pre>
</div>
</div>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_motors_config/ class="card-img-bottom" alt="..."> --><div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Wrap-up</h1>
<div class="container align-content-center" style="height: 100%">
<div class="row">
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk16/IMG_6637.jpg" class="figure-img img-fluid rounded" alt="alt text" title="Flight!"><figcaption class="figure-caption text-center" align="center">Flight!</figcaption></figure></div></p>
</div>
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="../wk16/IMG_6642.jpg" class="figure-img img-fluid rounded" alt="alt text" title="From below"><figcaption class="figure-caption text-center" align="center">From below</figcaption></figure></div></p>
</div>
</div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Wrap-up</h1>
<div class="container align-content-center" style="height: 100%">
<div id="wpnE13KWtOQ" class="eleventy-plugin-youtube-embed" style="position:relative;width:100%;padding-top: 56.25%;"><iframe style="position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;" width="100%" height="100%" frameborder="0" title="Embedded YouTube video" src="https://www.youtube-nocookie.com/embed/wpnE13KWtOQ" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
</div>
<div class="carousel-item" style="height: 100%">
<h1 class="text-center mt-3">Wrap-up</h1>
<div class="container align-content-center" style="height: 100%">
<h1 class="text-center">Questions?</h1>
<div class="row">
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-5.png" class="figure-img img-fluid rounded" alt="alt text" title=" "><figcaption class="figure-caption text-center" align="center"> </figcaption></figure></div></p>
</div>
<div class="col-lg-6 align-content-center">
<p><div class="d-flex justify-content-center"><figure class="figure justify-content-center"><img src="image-8.png" class="figure-img img-fluid rounded" alt="alt text" title=" "><figcaption class="figure-caption text-center" align="center"> </figcaption></figure></div></p>
</div>
</div>
<h1 class="text-center">Thank you!</h1>
</div>
</div>

<!--<img src=/engineering/drone/presentation/slide_wrap_up/ class="card-img-bottom" alt="..."> -->
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script src="/assets/js/index.js"></script>
    <script data-goatcounter="https://michaellangford99.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>
  </body>
</html>
